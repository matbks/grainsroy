sap.ui.define([                                                                                                                                                                                                                                                
    "./BaseController",                                                                                                                                                                                                                                        
    "sap/ui/model/json/JSONModel",                                                                                                                                                                                                                             
    "../model/formatter",                                                                                                                                                                                                                                      
    "sap/m/library",                                                                                                                                                                                                                                           
    "sap/ui/Device",                                                                                                                                                                                                                                           
], function (BaseController, JSONModel, formatter, mobileLibrary, Device) {                                                                                                                                                                                    
    "use strict";                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
    // shortcut for sap.m.URLHelper                                                                                                                                                                                                                            
    var URLHelper = mobileLibrary.URLHelper;                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                               
    return BaseController.extend("grains.zadograinsacmcontrollingclearingacc.controller.DetailDetail", {                                                                                                                                                       
                                                                                                                                                                                                                                                               
        formatter: formatter,                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
        onInit: function () {                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
            var oViewModel = new JSONModel({                                                                                                                                                                                                                   
                busy: false,                                                                                                                                                                                                                                   
                delay: 0,                                                                                                                                                                                                                                      
                lineItemListTitle: 'teste',                                                                                                                                                                                                                    
                routParameters: {},                                                                                                                                                                                                                            
            });                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                               
            this.getRouter().getRoute("detail").attachPatternMatched(this._onObjectMatched, this);                                                                                                                                                             
                                                                                                                                                                                                                                                               
            this.setModel(oViewModel, "detailDetailView");                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
            this.getOwnerComponent().getModel().metadataLoaded().then(this._onMetadataLoaded.bind(this));                                                                                                                                                      
                                                                                                                                                                                                                                                               
            this._level = 1;                                                                                                                                                                                                                                   
        },                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
        _onObjectMatched: function (oEvent) {                                                                                                                                                                                                                  
            var oModel = this.getView().getModel();                                                                                                                                                                                                            
            var oViewModel = this.getView().getModel("detailDetailView");                                                                                                                                                                                      
            var oRouteParameters = oEvent.getParameter("arguments");                                                                                                                                                                                           
            oViewModel.setProperty("/routParameters", oEvent.getParameter("arguments"));                                                                                                                                                                       
                                                                                                                                                                                                                                                               
            this.getModel("appView").setProperty("/layout", "ThreeColumnsMidExpanded");                                                                                                                                                                        
            oModel.metadataLoaded().then(function () {                                                                                                                                                                                                         
                var sDetailPath = oModel.createKey("/ZADOC_GRAINS_CTR_APP_INV_IV", {                                                                                                                                                                           
                    TradingContract: oRouteParameters.TradingContract,                                                                                                                                                                                         
                    AbdNumber: oRouteParameters.AbdNumber,                                                                                                                                                                                                     
                    AbdItem: oRouteParameters.AbdItem,                                                                                                                                                                                                         
                });                                                                                                                                                                                                                                            
                this._bindView(sDetailPath);                                                                                                                                                                                                                   
            }.bind(this));                                                                                                                                                                                                                                     
        },                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
        _bindView: function (sDetailPath) {                                                                                                                                                                                                                    
            // Set busy indicator during view binding                                                                                                                                                                                                          
            var oViewModel = this.getModel("detailDetailView");                                                                                                                                                                                                
                                                                                                                                                                                                                                                               
            // If the view was not bound yet its not busy, only if the binding requests data it is set to busy again                                                                                                                                           
            oViewModel.setProperty("/busy", false);                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
            this.getView().bindElement({                                                                                                                                                                                                                       
                path: sDetailPath,                                                                                                                                                                                                                             
                events: {                                                                                                                                                                                                                                      
                    change: this._onBindingChange.bind(this),                                                                                                                                                                                                  
                    dataRequested: function () {                                                                                                                                                                                                               
                        oViewModel.setProperty("/busy", true);                                                                                                                                                                                                 
                    },                                                                                                                                                                                                                                         
                    dataReceived: function () {                                                                                                                                                                                                                
                        oViewModel.setProperty("/busy", false);                                                                                                                                                                                                
                    }                                                                                                                                                                                                                                          
                }                                                                                                                                                                                                                                              
            });                                                                                                                                                                                                                                                
        },                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
        _onBindingChange: function () {                                                                                                                                                                                                                        
            var oView = this.getView(),                                                                                                                                                                                                                        
                oElementBinding = oView.getElementBinding();                                                                                                                                                                                                   
                                                                                                                                                                                                                                                               
            // No data for the binding                                                                                                                                                                                                                         
            if (!oElementBinding.getBoundContext()) {                                                                                                                                                                                                          
                this.getRouter().getTargets().display("detailObjectNotFound");                                                                                                                                                                                 
                // if object could not be found, the selection in the list                                                                                                                                                                                     
                // does not make sense anymore.                                                                                                                                                                                                                
                this.getOwnerComponent().oListSelector.clearMasterListSelection();                                                                                                                                                                             
                return;                                                                                                                                                                                                                                        
            }                                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
            // var sPath = oElementBinding.getPath(),                                                                                                                                                                                                          
            var oResourceBundle = this.getResourceBundle();                                                                                                                                                                                                    
            // oObject = oView.getModel().getObject(sPath),                                                                                                                                                                                                    
            // sObjectId = oObject.TradingContract,                                                                                                                                                                                                            
            // sObjectName = oObject.ApplicationDoc,                                                                                                                                                                                                           
            var oViewModel = this.getView().getModel("detailDetailView");                                                                                                                                                                                      
            var oRouteParameters = oViewModel.getProperty("/routParameters");                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
            var sObject = this.getView().getBindingContext().getObject();                                                                                                                                                                                      
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;                                                                                                                                                                                       
            this._getAccountingDocumentTree(sObject);                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
        },                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
        _onMetadataLoaded: function () {                                                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
            // // Store original busy indicator delay for the detail view                                                                                                                                                                                      
            // var iOriginalViewBusyDelay = this.getView().getBusyIndicatorDelay(),                                                                                                                                                                            
            //     oViewModel = this.getModel("detailDetailView"),                                                                                                                                                                                             
            //     oSmartTableInvoiceItems = this.byId("smartTableInvoiceItems"),                                                                                                                                                                              
            //     iOriginalBusyDelay = oSmartTableInvoiceItems.getBusyIndicatorDelay();                                                                                                                                                                       
                                                                                                                                                                                                                                                               
            // // Make sure busy indicator is displayed immediately when                                                                                                                                                                                       
            // // detail view is displayed for the first time                                                                                                                                                                                                  
            // oViewModel.setProperty("/delay", 0);                                                                                                                                                                                                            
            // oViewModel.setProperty("/invoiceItemsBusyDelay", 0);                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
            // oSmartTableInvoiceItems.attachEventOnce("updateFinished", function () {                                                                                                                                                                         
            //     // Restore original busy indicator delay for line item table                                                                                                                                                                                
            //     oViewModel.setProperty("/invoiceItemsBusyDelay", iOriginalBusyDelay);                                                                                                                                                                       
            // });                                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
            // // Binding the view will set it to not busy - so the view is always busy if it is not bound                                                                                                                                                     
            // oViewModel.setProperty("/busy", true);                                                                                                                                                                                                          
            // // Restore original busy indicator delay for the detail view                                                                                                                                                                                    
            // oViewModel.setProperty("/delay", iOriginalViewBusyDelay);                                                                                                                                                                                       
        },                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
        // _getAccountingDocumentTree: function () {                                                                                                                                                                                                           
        //     var oViewModel = this.getView().getModel("detailDetailView");                                                                                                                                                                                   
        //     var oObject = this.getView().getBindingContext().getObject();                                                                                                                                                                                   
                                                                                                                                                                                                                                                               
        //     var oModel = this.getView().getModel();                                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
        //     var aFilters = [new sap.ui.model.Filter({ path: "CompanyCode", operator: sap.ui.model.FilterOperator.EQ, value1: oObject.InvoiceCompanyCode }),                                                                                                 
        //     new sap.ui.model.Filter({ path: "AccountingDocument", operator: sap.ui.model.FilterOperator.EQ, value1: oObject.AccountingDocument }),                                                                                                          
        //     new sap.ui.model.Filter({ path: "AccountingDocumentYear", operator: sap.ui.model.FilterOperator.EQ, value1: oObject.AccountingDocumentYear }),                                                                                                  
        //     new sap.ui.model.Filter({ path: "AccountingItem", operator: sap.ui.model.FilterOperator.EQ, value1: oObject.AccountingItem })];                                                                                                                 
                                                                                                                                                                                                                                                               
        //     oModel.read('/AccountingDocumentTreeSet', {                                                                                                                                                                                                     
        //         filters: aFilters,                                                                                                                                                                                                                          
        //         success: function (oData, oResponse) {                                                                                                                                                                                                      
        //             var deepData = this._transformTreeData(oData.results);                                                                                                                                                                                  
        //             this.setNodesModelData(deepData);                                                                                                                                                                                                       
        //         }.bind(this),                                                                                                                                                                                                                               
        //         error: function (oError) {                                                                                                                                                                                                                  
        //         }.bind(this)                                                                                                                                                                                                                                
        //     })                                                                                                                                                                                                                                              
        // },                                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
        // setNodesModelData: function (nodes) {                                                                                                                                                                                                               
        //     var oTreeTableModel = this.getModel("nodeModel");                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
        //     if (oTreeTableModel) {                                                                                                                                                                                                                          
        //         oTreeTableModel.setData({ nodeRoot: { children: nodes } });                                                                                                                                                                                 
        //         oTreeTableModel.refresh();                                                                                                                                                                                                                  
        //         var oTreeTable = this.byId("treeTable").refreshRows();                                                                                                                                                                                      
        //     } else {                                                                                                                                                                                                                                        
        //         var nodesModel = new sap.ui.model.json.JSONModel();                                                                                                                                                                                         
        //         nodesModel.setData({ nodeRoot: { children: nodes } });                                                                                                                                                                                      
        //         this.setModel(nodesModel, "nodeModel");                                                                                                                                                                                                     
        //     };                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
        // },                                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
        onCloseDetailPress: function () {                                                                                                                                                                                                                      
            this.getModel("appView").setProperty("/actionButtonsInfo/midColumn/fullScreen", false);                                                                                                                                                            
            // No item should be selected on list after detail page is closed                                                                                                                                                                                  
            // this.getOwnerComponent().oListSelector.clearMasterListSelection();                                                                                                                                                                              
            var oViewModel = this.getView().getModel("detailDetailView");                                                                                                                                                                                      
            var oRouteParameters = oViewModel.getProperty("/routParameters");                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
            var bReplace = !Device.system.phone;                                                                                                                                                                                                               
            this.getModel("appView").setProperty("/layout", "TwoColumnsMidExpanded");                                                                                                                                                                          
            this.getRouter().navTo("object", {                                                                                                                                                                                                                 
                TradingContract: oRouteParameters.TradingContract,                                                                                                                                                                                             
                AbdNumber: oRouteParameters.AbdNumber,                                                                                                                                                                                                         
            }, bReplace);                                                                                                                                                                                                                                      
        },                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
        toggleFullScreen: function () {                                                                                                                                                                                                                        
            var bFullScreen = this.getModel("appView").getProperty("/actionButtonsInfo/midColumn/fullScreen");                                                                                                                                                 
            this.getModel("appView").setProperty("/actionButtonsInfo/midColumn/fullScreen", !bFullScreen);                                                                                                                                                     
            if (!bFullScreen) {                                                                                                                                                                                                                                
                // store current layout and go full screen                                                                                                                                                                                                     
                this.getModel("appView").setProperty("/previousLayout", this.getModel("appView").getProperty("/layout"));                                                                                                                                      
                this.getModel("appView").setProperty("/layout", "EndColumnFullScreen");                                                                                                                                                                        
            } else {                                                                                                                                                                                                                                           
                // reset to previous layout                                                                                                                                                                                                                    
                this.getModel("appView").setProperty("/layout", this.getModel("appView").getProperty("/previousLayout"));                                                                                                                                      
            }                                                                                                                                                                                                                                                  
        },                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
        onCollapseAll: function (oEvent) {                                                                                                                                                                                                                     
            this._level = 0;                                                                                                                                                                                                                                   
            var oTreeTable = this.byId("treeTable");                                                                                                                                                                                                           
            oTreeTable.collapseAll();                                                                                                                                                                                                                          
        },                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
        onExpandAll: function (oEvent) {                                                                                                                                                                                                                       
            var oTreeTable = this.byId("treeTable");                                                                                                                                                                                                           
            oTreeTable.expandToLevel(10);                                                                                                                                                                                                                      
        },                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
        onExpandFirstLevel: function (oEvent) {                                                                                                                                                                                                                
            var oTreeTable = this.byId("treeTable");                                                                                                                                                                                                           
            oTreeTable.expandToLevel(1);                                                                                                                                                                                                                       
        },                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
    });                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
});                                                                                                                                                                                                                                                            