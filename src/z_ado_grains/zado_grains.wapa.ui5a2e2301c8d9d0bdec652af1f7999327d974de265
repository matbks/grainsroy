sap.ui.define([                                                                                                                                                                                                                                                
    "./BaseController",                                                                                                                                                                                                                                        
    "sap/ui/core/Fragment",                                                                                                                                                                                                                                    
    "sap/ui/model/Filter",                                                                                                                                                                                                                                     
    "sap/ui/model/FilterOperator",                                                                                                                                                                                                                             
],                                                                                                                                                                                                                                                             
    /**                                                                                                                                                                                                                                                        
     * @param {typeof sap.ui.core.mvc.Controller} Controller                                                                                                                                                                                                   
     */                                                                                                                                                                                                                                                        
    function (BaseController, Fragment, Filter, FilterOperator) {                                                                                                                                                                                              
        "use strict";                                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
        return BaseController.extend("grains.zadograinsacmcontrolling.controller.Contracts", {                                                                                                                                                                 
            onInit: function () {                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
            },                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
            onContractPress: function (oEvent) {                                                                                                                                                                                                               
                this._SelectedContract = this.getView().getModel().getData(oEvent.oSource._aSelectedPaths[0])                                                                                                                                                  
                let oContext = oEvent.getSource().getSelectedItem().getBindingContext()                                                                                                                                                                        
                this.putStorage("SelectedPath", { Path: oContext.sPath })                                                                                                                                                                                      
                this.byId("SmartTableContracts").getTable().removeSelections()                                                                                                                                                                                 
                this.getRouter().navTo("RouteContractDetails", {                                                                                                                                                                                               
                    Contract: this._SelectedContract.ContractNum                                                                                                                                                                                               
                })                                                                                                                                                                                                                                             
            },                                                                                                                                                                                                                                                 
            onValueHelpPartner: function (oEvent) {                                                                                                                                                                                                            
                if (!this._PartnersFragment) {                                                                                                                                                                                                                 
                    this._PartnersFragment = Fragment.load({                                                                                                                                                                                                   
                        id: this.getView().getId(),                                                                                                                                                                                                            
                        name: "grains.zadograinsacmcontrolling.view.fragments.PartnersValueHelp",                                                                                                                                                              
                        controller: this                                                                                                                                                                                                                       
                    }).then(function (oValueHelpDialog) {                                                                                                                                                                                                      
                        this.getView().addDependent(oValueHelpDialog);                                                                                                                                                                                         
                        return oValueHelpDialog;                                                                                                                                                                                                               
                    }.bind(this));                                                                                                                                                                                                                             
                }                                                                                                                                                                                                                                              
                this._PartnersFragment.then(function (oValueHelpDialog) {                                                                                                                                                                                      
                    oValueHelpDialog.open();                                                                                                                                                                                                                   
                }.bind(this));                                                                                                                                                                                                                                 
            },                                                                                                                                                                                                                                                 
            onRebind: function (oEvent) {                                                                                                                                                                                                                      
                let oBindingParams = oEvent.getParameter("bindingParams");                                                                                                                                                                                     
                let Partner = this.byId("Partner").getValue()                                                                                                                                                                                                  
                if (Partner != '') {                                                                                                                                                                                                                           
                    oBindingParams.filters.push(new sap.ui.model.Filter("Partner", "EQ", Partner));                                                                                                                                                            
                }                                                                                                                                                                                                                                              
            },                                                                                                                                                                                                                                                 
            onValueHelpSearch: function (oEvent) {                                                                                                                                                                                                             
                let oFilter = new Filter("PartnerName", FilterOperator.Contains, oEvent.getParameter("value"));                                                                                                                                                
                oEvent.getSource().getBinding("items").filter([oFilter]);                                                                                                                                                                                      
            },                                                                                                                                                                                                                                                 
            onValueHelpClose: function (oEvent) {                                                                                                                                                                                                              
                try {                                                                                                                                                                                                                                          
                    this.byId("Partner").setValue(oEvent.getParameters().selectedItem.mProperties.title)                                                                                                                                                       
                    this.byId("SmartTableContracts").rebindTable(true)                                                                                                                                                                                         
                }                                                                                                                                                                                                                                              
                catch {                                                                                                                                                                                                                                        
                    this.byId("Partner").setValue("")                                                                                                                                                                                                          
                }                                                                                                                                                                                                                                              
            },                                                                                                                                                                                                                                                 
        });                                                                                                                                                                                                                                                    
    });                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               