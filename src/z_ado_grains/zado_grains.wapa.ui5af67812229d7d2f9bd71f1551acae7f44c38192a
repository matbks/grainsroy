sap.ui.define([                                                                                                                                                                                                                                                
    "./BaseController",                                                                                                                                                                                                                                        
    "sap/ui/core/Fragment",                                                                                                                                                                                                                                    
    "sap/ui/model/json/JSONModel",                                                                                                                                                                                                                             
    "../model/formatter",                                                                                                                                                                                                                                      
    "../model/models",                                                                                                                                                                                                                                         
    "sap/ui/model/Filter",                                                                                                                                                                                                                                     
    "sap/ui/model/FilterOperator",                                                                                                                                                                                                                             
    "sap/m/MessageBox",                                                                                                                                                                                                                                        
    "sap/m/MessageToast",                                                                                                                                                                                                                                      
    "sap/ui/model/Sorter"                                                                                                                                                                                                                                      
], function (                                                                                                                                                                                                                                                  
    BaseController,                                                                                                                                                                                                                                            
    Fragment,                                                                                                                                                                                                                                                  
    JSONModel,                                                                                                                                                                                                                                                 
    formatter,                                                                                                                                                                                                                                                 
    models,                                                                                                                                                                                                                                                    
    Filter,                                                                                                                                                                                                                                                    
    FilterOperator,                                                                                                                                                                                                                                            
    MessageBox,                                                                                                                                                                                                                                                
    MessageToast,                                                                                                                                                                                                                                              
    Sorter                                                                                                                                                                                                                                                     
) {                                                                                                                                                                                                                                                            
    "use strict";                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
    return BaseController.extend("grains.zadograinsacmcontrolling.controller.ContractFixation", {                                                                                                                                                              
                                                                                                                                                                                                                                                               
        /**                                                                                                                                                                                                                                                    
         * @override                                                                                                                                                                                                                                           
         */                                                                                                                                                                                                                                                    
                                                                                                                                                                                                                                                               
        formatter: formatter,                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
        onInit: function () {                                                                                                                                                                                                                                  
            this.initMessageProcessor()                                                                                                                                                                                                                        
            this.getRouter().attachRoutePatternMatched(this._onObjectMathed, this)                                                                                                                                                                             
        },                                                                                                                                                                                                                                                     
        _onObjectMathed: function (oEvent) {                                                                                                                                                                                                                   
            this._Fixation = oEvent.getParameter("arguments").Fixation                                                                                                                                                                                         
            this._oModel = this.getModel()                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
            if (!this._Fixation) {                                                                                                                                                                                                                             
                this._newFixation()                                                                                                                                                                                                                            
            } else {                                                                                                                                                                                                                                           
                this._getFixation(this._Fixation)                                                                                                                                                                                                              
            }                                                                                                                                                                                                                                                  
        },                                                                                                                                                                                                                                                     
        _newFixation: function () {                                                                                                                                                                                                                            
            this.getModel().read(this.getStorage("SelectedPath").Path, {                                                                                                                                                                                       
                success: function (oData) {                                                                                                                                                                                                                    
                    this.getOwnerComponent().setModel(new JSONModel(oData), "ContractDetailsModel")                                                                                                                                                            
                    this.byId("ContractFixationCreationPage").setVisible(true)                                                                                                                                                                                 
                    this.byId("ContractFixationDetailPage").setVisible(false)                                                                                                                                                                                  
                }.bind(this),                                                                                                                                                                                                                                  
                error: function () {                                                                                                                                                                                                                           
                    MessageToast.show("Falha ao obter dados do contrato")                                                                                                                                                                                      
                }                                                                                                                                                                                                                                              
            })                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
            this._applicationsListInitialization()                                                                                                                                                                                                             
            this._refreshViewData()                                                                                                                                                                                                                            
        },                                                                                                                                                                                                                                                     
        _applicationsListInitialization: function () {                                                                                                                                                                                                         
            this._oContext = new sap.ui.model.Context(this.getOwnerComponent().getModel(), this.getStorage("SelectedPath").Path)                                                                                                                               
            this.byId("ApplicationsSmartList").setBindingContext(this._oContext)                                                                                                                                                                               
            this.byId("ApplicationsSmartList").getList().removeSelections()                                                                                                                                                                                    
        },                                                                                                                                                                                                                                                     
        _getFixation: function (Fixation) {                                                                                                                                                                                                                    
            this.byId("ContractFixationCreationPage").setVisible(false)                                                                                                                                                                                        
            this.byId("ContractFixationDetailPage").setVisible(true)                                                                                                                                                                                           
                                                                                                                                                                                                                                                               
            this.getView().bindElement(this.getStorage("Fixation").sPath)                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
        },                                                                                                                                                                                                                                                     
        onSqueeze: function () {                                                                                                                                                                                                                               
            if (this.byId("SqueezeButton").getTooltip() == "Hide") {                                                                                                                                                                                           
                this.byId("ContractFixationCreationPage").setMode("HideMode")                                                                                                                                                                                  
                this.byId("SqueezeButton").setIcon("sap-icon://navigation-right-arrow")                                                                                                                                                                        
                this.byId("SqueezeButton").setTooltip("Expand")                                                                                                                                                                                                
            } else {                                                                                                                                                                                                                                           
                this.byId("ContractFixationCreationPage").setMode("ShowHideMode")                                                                                                                                                                              
                this.byId("SqueezeButton").setIcon("sap-icon://nav-back")                                                                                                                                                                                      
                this.byId("SqueezeButton").setTooltip("Hide")                                                                                                                                                                                                  
            }                                                                                                                                                                                                                                                  
        },                                                                                                                                                                                                                                                     
        _getApplicationData: function () {                                                                                                                                                                                                                     
            return new Promise((resolve, reject) => {                                                                                                                                                                                                          
                if (this._selectedApplication) {                                                                                                                                                                                                               
                    this._oModel.read("/ZADOC_GRAINS_EDC_FROM_CONTRACT", {                                                                                                                                                                                     
                        filters: [                                                                                                                                                                                                                             
                            new Filter("Property", FilterOperator.EQ, this._selectedApplication.Property),                                                                                                                                                     
                            new Filter("ContractNum", FilterOperator.EQ, this._selectedApplication.ContractNum),                                                                                                                                               
                            new Filter("Transgenic", FilterOperator.EQ, this._selectedApplication.IdRoyalties),                                                                                                                                                
                            new Filter("Plant", FilterOperator.EQ, this._selectedApplication.Plant),                                                                                                                                                           
                            new Filter("AvailableQuantity", FilterOperator.GT, 0),                                                                                                                                                                             
                            new Filter("NfeQuantity", FilterOperator.GT, 0)                                                                                                                                                                                    
                        ],                                                                                                                                                                                                                                     
                        success: function (oData) {                                                                                                                                                                                                            
                            try {                                                                                                                                                                                                                              
                                this.getOwnerComponent().getModel("ApplicationsProperty").setData(oData)                                                                                                                                                       
                                this.refreshModel("ApplicationsProperty")                                                                                                                                                                                      
                                resolve()                                                                                                                                                                                                                      
                            } catch {                                                                                                                                                                                                                          
                                reject("Falha ao obter documentos de aplicação da propriedade")                                                                                                                                                                
                            }                                                                                                                                                                                                                                  
                        }.bind(this),                                                                                                                                                                                                                          
                        error: function () { reject("Falha ao obter documentos de aplicação da propriedade") }                                                                                                                                                 
                    })                                                                                                                                                                                                                                         
                } else { reject("Selecione uma propriedade válida para realizar a fixação") }                                                                                                                                                                  
            })                                                                                                                                                                                                                                                 
        },                                                                                                                                                                                                                                                     
        _getCommodityData: function () {                                                                                                                                                                                                                       
            return new Promise((resolve, reject) => {                                                                                                                                                                                                          
                this._oModel.read("/ZADOC_GRAINS_COMMODITY_DATA", {                                                                                                                                                                                            
                    filters: [                                                                                                                                                                                                                                 
                        new Filter("CompanyCode", FilterOperator.EQ, this.getOwnerComponent().getModel("ContractDetailsModel").getData().CompanyCode),                                                                                                         
                        new Filter("AppCode", FilterOperator.EQ, "ACMCONTROL"),                                                                                                                                                                                
                        new Filter("Commodity", FilterOperator.EQ, this.getOwnerComponent().getModel("ContractDetailsModel").getData().MaterialNum)                                                                                                            
                    ],                                                                                                                                                                                                                                         
                    success: function (oData) {                                                                                                                                                                                                                
                        try {                                                                                                                                                                                                                                  
                            this.getOwnerComponent().getModel("ConversionsModel").oData.CommodityFactor = oData.results[0].ConversionFactor                                                                                                                    
                            this.getOwnerComponent().getModel("ConversionsModel").oData.RoyaltiesBlockPerc = oData.results[0].RoyaltiesBlockPerc                                                                                                               
                            resolve()                                                                                                                                                                                                                          
                        } catch {                                                                                                                                                                                                                              
                            reject("Falha ao obter dados da commodity")                                                                                                                                                                                        
                        }                                                                                                                                                                                                                                      
                    }.bind(this),                                                                                                                                                                                                                              
                    error: function (oError) { reject("Falha ao obter dados da commodity") }                                                                                                                                                                   
                })                                                                                                                                                                                                                                             
            })                                                                                                                                                                                                                                                 
        },                                                                                                                                                                                                                                                     
        _getDolarQuotation: function () {                                                                                                                                                                                                                      
            return new Promise((resolve, reject) => {                                                                                                                                                                                                          
                this._oModel.read("/ZADOC_GRAINS_DOLAR_QUOTATION", {                                                                                                                                                                                           
                    success: function (oData) {                                                                                                                                                                                                                
                        try {                                                                                                                                                                                                                                  
                            this.getOwnerComponent().getModel("ConversionsModel").oData.DolarQuotation = oData.results[0].Ukurs                                                                                                                                
                            this.refreshModel("ConversionsModel")                                                                                                                                                                                              
                            resolve()                                                                                                                                                                                                                          
                        } catch {                                                                                                                                                                                                                              
                            reject("Falha ao obter cotação do dólar")                                                                                                                                                                                          
                        }                                                                                                                                                                                                                                      
                    }.bind(this),                                                                                                                                                                                                                              
                    error: function (oError) { reject("Falha ao obter cotação do dólar") }                                                                                                                                                                     
                })                                                                                                                                                                                                                                             
            })                                                                                                                                                                                                                                                 
        },                                                                                                                                                                                                                                                     
        _PaymentDateValidate: function () {                                                                                                                                                                                                                    
            return new Promise((resolve, reject) => {                                                                                                                                                                                                          
                this._PaymentDate = this.getOwnerComponent().getModel("Fixation").getData().PaymentDate                                                                                                                                                        
                this._NewPaymentDate = this._PaymentDate.split('.')                                                                                                                                                                                            
                this._NewPaymentDate = new Date(this._NewPaymentDate[2], this._NewPaymentDate[1] - 1, this._NewPaymentDate[0], 23, 59, 59)                                                                                                                     
                if ((this._NewPaymentDate instanceof Date && !isNaN(this._NewPaymentDate)) && this._NewPaymentDate >= new Date()) {                                                                                                                            
                    let oData = {                                                                                                                                                                                                                              
                        Action: "DATEVALID",                                                                                                                                                                                                                   
                        Json: JSON.stringify([{ PaymentDate: this._PaymentDate.replaceAll(".", "") }]),                                                                                                                                                        
                        StructureName: "ZADOS_GRAINS_PAYMENT_DATE"                                                                                                                                                                                             
                    }                                                                                                                                                                                                                                          
                    this._oModel.create("/JsonCommunicationSet", oData, {                                                                                                                                                                                      
                        success: function (oData) {                                                                                                                                                                                                            
                            resolve()                                                                                                                                                                                                                          
                        },                                                                                                                                                                                                                                     
                        error: function (oError) { reject("Selecione uma data válida") }                                                                                                                                                                       
                    })                                                                                                                                                                                                                                         
                } else { reject("Selecione uma data válida") }                                                                                                                                                                                                 
            })                                                                                                                                                                                                                                                 
        },                                                                                                                                                                                                                                                     
        _getFuturePrice: function () {                                                                                                                                                                                                                         
            this._NewPaymentDate.setDate(this._NewPaymentDate.getDate() - 1)                                                                                                                                                                                   
            return new Promise((resolve, reject) => {                                                                                                                                                                                                          
                let Day = new Date()                                                                                                                                                                                                                           
                this._oModel.read("/ZADOC_GRAINS_FUTURE_PRICE", {                                                                                                                                                                                              
                    filters: [                                                                                                                                                                                                                                 
                        new Filter("Commodity", FilterOperator.EQ, this.getOwnerComponent().getModel("ContractDetailsModel").getData().MaterialNum),                                                                                                           
                        new Filter("Plant", FilterOperator.EQ, this._selectedApplication.Plant),                                                                                                                                                               
                        new Filter("CompanyCode", FilterOperator.EQ, this.getOwnerComponent().getModel("ContractDetailsModel").getData().CompanyCode),                                                                                                         
                        new Filter("DueDate", FilterOperator.GE, this._NewPaymentDate),                                                                                                                                                                        
                        new Filter("PriceDate", FilterOperator.EQ, Day),                                                                                                                                                                                       
                    ],                                                                                                                                                                                                                                         
                    sorters: [                                                                                                                                                                                                                                 
                        new Sorter("DueDate", false)                                                                                                                                                                                                           
                    ],                                                                                                                                                                                                                                         
                    success: function (oData) {                                                                                                                                                                                                                
                        try {                                                                                                                                                                                                                                  
                            this.getOwnerComponent().getModel("Fixation").oData.FuturePrice = oData.results[0].Price                                                                                                                                           
                            this.getOwnerComponent().getModel("Fixation").oData.DueCode = oData.results[0].DueCode                                                                                                                                             
                            this.getOwnerComponent().getModel("Fixation").oData.AvailableQuantity = this.getView().getModel("Application").getData().AvailableQuantity                                                                                         
                            this.refreshModel("Fixation")                                                                                                                                                                                                      
                            this._NewPaymentDate.setDate(this._NewPaymentDate.getDate() + 1)                                                                                                                                                                   
                            resolve()                                                                                                                                                                                                                          
                        } catch {                                                                                                                                                                                                                              
                            reject("Falha ao obter preço futuro")                                                                                                                                                                                              
                        }                                                                                                                                                                                                                                      
                    }.bind(this),                                                                                                                                                                                                                              
                    error: function (oError) {                                                                                                                                                                                                                 
                        this._NewPaymentDate.setDate(this._NewPaymentDate.getDate() + 1)                                                                                                                                                                       
                        reject("Falha ao obter preço futuro")                                                                                                                                                                                                  
                    }                                                                                                                                                                                                                                          
                })                                                                                                                                                                                                                                             
            })                                                                                                                                                                                                                                                 
        },                                                                                                                                                                                                                                                     
        _getRoyaltiesBlocks: function () {                                                                                                                                                                                                                     
            return new Promise((resolve, reject) => {                                                                                                                                                                                                          
                var Filters = []                                                                                                                                                                                                                               
                this.getOwnerComponent().getModel("ApplicationsProperty").getData().results.forEach((application) => {                                                                                                                                         
                    Filters.push(new Filter("EdcNum", FilterOperator.EQ, application.EdcNum))                                                                                                                                                                  
                })                                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
                this._oModel.read("/ZADOC_GRAINS_ROYALTIES_BLOCK", {                                                                                                                                                                                           
                    filters: Filters,                                                                                                                                                                                                                          
                    success: function (oData) {                                                                                                                                                                                                                
                        try {                                                                                                                                                                                                                                  
                            this.getOwnerComponent().getModel("RoyaltiesBlocks").oData.items = oData.results                                                                                                                                                   
                            this.refreshModel("RoyaltiesBlocks")                                                                                                                                                                                               
                            resolve()                                                                                                                                                                                                                          
                        } catch {                                                                                                                                                                                                                              
                            reject("Falha ao obter bloqueios de royalties")                                                                                                                                                                                    
                        }                                                                                                                                                                                                                                      
                    }.bind(this),                                                                                                                                                                                                                              
                    error: function (oError) {                                                                                                                                                                                                                 
                        reject("Falha ao obter bloqueios de royalties")                                                                                                                                                                                        
                    }.bind(this)                                                                                                                                                                                                                               
                })                                                                                                                                                                                                                                             
            })                                                                                                                                                                                                                                                 
        },                                                                                                                                                                                                                                                     
        onFixation: function (oEvent) {                                                                                                                                                                                                                        
            let oObject = this.getOwnerComponent().getModel("ContractDetailsModel").getData();                                                                                                                                                                 
                                                                                                                                                                                                                                                               
            if (this._selectedApplication.Plant != undefined) {                                                                                                                                                                                                
                let Authorization = {                                                                                                                                                                                                                          
                    Company_Code: oObject.CompanyCode,                                                                                                                                                                                                         
                    Plant: this._selectedApplication.Plant,                                                                                                                                                                                                    
                    Authorization: "FIX_CRT"                                                                                                                                                                                                                   
                }                                                                                                                                                                                                                                              
                this.authValidate(Authorization).then(() => {                                                                                                                                                                                                  
                    this._PaymentDateValidate().then(() => {                                                                                                                                                                                                   
                        this._getDolarQuotation().then(() => {                                                                                                                                                                                                 
                            this._getCommodityData().then(() => {                                                                                                                                                                                              
                                this._getApplicationData().then(() => {                                                                                                                                                                                        
                                    this._getRoyaltiesBlocks().then(() => {                                                                                                                                                                                    
                                        this._getFuturePrice().then(() => {                                                                                                                                                                                    
                                            this._fixationPopupPrepare()                                                                                                                                                                                       
                                        }).catch((error) => {                                                                                                                                                                                                  
                                            MessageBox.show(error, {                                                                                                                                                                                           
                                                icon: MessageBox.Icon.INFORMATION,                                                                                                                                                                             
                                                title: "Aviso"                                                                                                                                                                                                 
                                            })                                                                                                                                                                                                                 
                                        })                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
                                    }).catch((error) => {                                                                                                                                                                                                      
                                        MessageBox.show(error, {                                                                                                                                                                                               
                                            icon: MessageBox.Icon.INFORMATION,                                                                                                                                                                                 
                                            title: "Aviso"                                                                                                                                                                                                     
                                        })                                                                                                                                                                                                                     
                                    })                                                                                                                                                                                                                         
                                                                                                                                                                                                                                                               
                                }).catch((error) => {                                                                                                                                                                                                          
                                    MessageBox.show(error, {                                                                                                                                                                                                   
                                        icon: MessageBox.Icon.INFORMATION,                                                                                                                                                                                     
                                        title: "Aviso"                                                                                                                                                                                                         
                                    })                                                                                                                                                                                                                         
                                })                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
                            }).catch((error) => {                                                                                                                                                                                                              
                                MessageBox.show(error, {                                                                                                                                                                                                       
                                    icon: MessageBox.Icon.INFORMATION,                                                                                                                                                                                         
                                    title: "Aviso"                                                                                                                                                                                                             
                                })                                                                                                                                                                                                                             
                            })                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
                        }).catch((error) => {                                                                                                                                                                                                                  
                            MessageBox.show(error, {                                                                                                                                                                                                           
                                icon: MessageBox.Icon.INFORMATION,                                                                                                                                                                                             
                                title: "Aviso"                                                                                                                                                                                                                 
                            })                                                                                                                                                                                                                                 
                        })                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
                    }).catch((error) => {                                                                                                                                                                                                                      
                        MessageBox.show(error, {                                                                                                                                                                                                               
                            icon: MessageBox.Icon.INFORMATION,                                                                                                                                                                                                 
                            title: "Aviso"                                                                                                                                                                                                                     
                        })                                                                                                                                                                                                                                     
                    })                                                                                                                                                                                                                                         
                }).catch(() => {                                                                                                                                                                                                                               
                    MessageBox.show("Usuário não possui permissão para realizar a fixação", {                                                                                                                                                                  
                        icon: MessageBox.Icon.INFORMATION,                                                                                                                                                                                                     
                        title: "Aviso"                                                                                                                                                                                                                         
                    })                                                                                                                                                                                                                                         
                })                                                                                                                                                                                                                                             
            } else {                                                                                                                                                                                                                                           
                MessageBox.show("Nenhuma aplicação foi selecionada", {                                                                                                                                                                                         
                    icon: MessageBox.Icon.INFORMATION,                                                                                                                                                                                                         
                    title: "Aviso"                                                                                                                                                                                                                             
                })                                                                                                                                                                                                                                             
            }                                                                                                                                                                                                                                                  
        },                                                                                                                                                                                                                                                     
        _fixationPopupPrepare: function () {                                                                                                                                                                                                                   
            if (this.getView().getModel("Application").getData().Quantity > 0) {                                                                                                                                                                               
                if (this.getOwnerComponent().getModel("ConversionsModel").getData().DolarQuotation > 0) {                                                                                                                                                      
                    if (this.getOwnerComponent().getModel("Fixation").oData.FuturePrice > 0) {                                                                                                                                                                 
                        this._showFixationPopup()                                                                                                                                                                                                              
                    } else {                                                                                                                                                                                                                                   
                        MessageBox.show("Não foi possível estabelecer o preço futuro", {                                                                                                                                                                       
                            icon: MessageBox.Icon.INFORMATION,                                                                                                                                                                                                 
                            title: "Aviso"                                                                                                                                                                                                                     
                        })                                                                                                                                                                                                                                     
                    }                                                                                                                                                                                                                                          
                } else {                                                                                                                                                                                                                                       
                    MessageBox.show("Não foi possível estabelecer a cotação do dólar", {                                                                                                                                                                       
                        icon: MessageBox.Icon.INFORMATION,                                                                                                                                                                                                     
                        title: "Aviso"                                                                                                                                                                                                                         
                    })                                                                                                                                                                                                                                         
                }                                                                                                                                                                                                                                              
            } else {                                                                                                                                                                                                                                           
                MessageBox.show("Selecione uma propriedade com saldo para realizar a fixação", {                                                                                                                                                               
                    icon: MessageBox.Icon.INFORMATION,                                                                                                                                                                                                         
                    title: "Aviso"                                                                                                                                                                                                                             
                })                                                                                                                                                                                                                                             
            }                                                                                                                                                                                                                                                  
        },                                                                                                                                                                                                                                                     
        _showFixationPopup: function () {                                                                                                                                                                                                                      
            if (!this._FixationFragment) {                                                                                                                                                                                                                     
                this._FixationFragment = Fragment.load({                                                                                                                                                                                                       
                    id: this.getView().getId(),                                                                                                                                                                                                                
                    name: "grains.zadograinsacmcontrolling.view.fragments.Fixation",                                                                                                                                                                           
                    controller: this                                                                                                                                                                                                                           
                }).then(function (oValueHelpDialog) {                                                                                                                                                                                                          
                    this.getView().addDependent(oValueHelpDialog);                                                                                                                                                                                             
                    return oValueHelpDialog;                                                                                                                                                                                                                   
                }.bind(this));                                                                                                                                                                                                                                 
            }                                                                                                                                                                                                                                                  
            this._FixationFragment.then(function (oValueHelpDialog) {                                                                                                                                                                                          
                oValueHelpDialog.open();                                                                                                                                                                                                                       
            });                                                                                                                                                                                                                                                
        },                                                                                                                                                                                                                                                     
        onCloseFixation: function () {                                                                                                                                                                                                                         
            this._getApplicationData()                                                                                                                                                                                                                         
            this.getOwnerComponent().getModel("BankData").oData.items = []                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
            this.getOwnerComponent().getModel("Fixation").setData(models.createLineFixation())                                                                                                                                                                 
                                                                                                                                                                                                                                                               
            this.refreshModel("Fixation")                                                                                                                                                                                                                      
            this.refreshModel("BankData")                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
            this.byId("MessageStrip").setVisible(false)                                                                                                                                                                                                        
            this.byId("FixationDialog").close()                                                                                                                                                                                                                
        },                                                                                                                                                                                                                                                     
        _toNumber: function (Price) {                                                                                                                                                                                                                          
            Price = Price.toString()                                                                                                                                                                                                                           
            return parseFloat(Price.replace(',', '.'))                                                                                                                                                                                                         
        },                                                                                                                                                                                                                                                     
        onSaveFixation: function (oEvent) {                                                                                                                                                                                                                    
            if (this._fixationPopUpValidate().isValid) {                                                                                                                                                                                                       
                this.byId("MessageStrip").setVisible(false)                                                                                                                                                                                                    
                                                                                                                                                                                                                                                               
                let Fixation = this.getOwnerComponent().getModel("Fixation").getData()                                                                                                                                                                         
                                                                                                                                                                                                                                                               
                this._updateApplicationsTable(Fixation.Quantity)                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
                this._CommodityConversionFactor = this.getOwnerComponent().getModel("ConversionsModel").getData().CommodityFactor                                                                                                                              
                this._DolarQuotation = this.getOwnerComponent().getModel("ConversionsModel").getData().DolarQuotation                                                                                                                                          
                this._RoyaltiesBlockPerc = this.getOwnerComponent().getModel("ConversionsModel").getData().RoyaltiesBlockPerc                                                                                                                                  
                                                                                                                                                                                                                                                               
                let LineBankData = models.createLineFixationBankModel()                                                                                                                                                                                        
                LineBankData.Amount = Fixation.Amount = ((Fixation.BagPrice[0] / 60) * Fixation.Quantity) -                                                                                                                                                    
                    ((Fixation.BlockedQuantity * (Fixation.BagPrice[0] / 60)) * this._RoyaltiesBlockPerc)                                                                                                                                                      
                LineBankData.PaymentDate = this.getOwnerComponent().getModel("Fixation").getData().PaymentDate                                                                                                                                                 
                                                                                                                                                                                                                                                               
                Fixation.BasisPrice = (((this._toNumber(Fixation.BagPrice) / this._DolarQuotation) / this._CommodityConversionFactor) -                                                                                                                        
                    this._toNumber(Fixation.FuturePrice))                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
                this.getOwnerComponent().getModel("BankData").oData.items = [LineBankData]                                                                                                                                                                     
                this.getOwnerComponent().getModel("Fixation").setData(Fixation)                                                                                                                                                                                
                                                                                                                                                                                                                                                               
                this.getOwnerComponent().getModel("BankData").refresh(true)                                                                                                                                                                                    
                this.getOwnerComponent().getModel("Fixation").refresh(true)                                                                                                                                                                                    
                this.getOwnerComponent().getModel("ConversionsModel").refresh(true)                                                                                                                                                                            
                                                                                                                                                                                                                                                               
                this.byId("FixationDialog").close()                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
            } else {                                                                                                                                                                                                                                           
                this.byId("MessageStrip").setType(this._fixationPopUpValidate().State)                                                                                                                                                                         
                this.byId("MessageStrip").setText(this._fixationPopUpValidate().Message)                                                                                                                                                                       
                this.byId("MessageStrip").setVisible(true)                                                                                                                                                                                                     
            }                                                                                                                                                                                                                                                  
        },                                                                                                                                                                                                                                                     
        onChangeQuantity: function (oEvent) {                                                                                                                                                                                                                  
            let Fixation = this.getOwnerComponent().getModel("Fixation").getData()                                                                                                                                                                             
            this._updateApplicationsTable(Fixation.Quantity)                                                                                                                                                                                                   
        },                                                                                                                                                                                                                                                     
        _updateApplicationsTable: function (RemainingQuantity) {                                                                                                                                                                                               
            this._BlockedQuantity = 0                                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
            this.getOwnerComponent().getModel("ApplicationsProperty").getData().results.forEach((element) => {                                                                                                                                                 
                element.FinalQuantity = element.AvailableQuantity                                                                                                                                                                                              
            })                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
            this.getOwnerComponent().getModel("ApplicationsProperty").getData().results.forEach((element) => {                                                                                                                                                 
                element.FinalQuantity = element.FinalQuantity - RemainingQuantity                                                                                                                                                                              
                RemainingQuantity = element.FinalQuantity < 0 ? element.FinalQuantity * -1 : "0"                                                                                                                                                               
                element.FinalQuantity = element.FinalQuantity > 0 ? element.FinalQuantity : "0"                                                                                                                                                                
                this._BlockedQuantity = element.FinalQuantity >= element.BlockedQuantity ? this._BlockedQuantity :                                                                                                                                             
                    ((element.FinalQuantity - element.BlockedQuantity) * -1) + this._BlockedQuantity                                                                                                                                                           
            })                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
            this.getOwnerComponent().getModel("Fixation").getData().BlockedQuantity = this._BlockedQuantity                                                                                                                                                    
                                                                                                                                                                                                                                                               
            this.refreshModel("ApplicationsProperty")                                                                                                                                                                                                          
            this.refreshModel("Fixation")                                                                                                                                                                                                                      
        },                                                                                                                                                                                                                                                     
        _fixationPopUpValidate: function () {                                                                                                                                                                                                                  
            let Fixation = this.getOwnerComponent().getModel("Fixation").getData()                                                                                                                                                                             
            let PartnerBlockQuantity = this.getOwnerComponent().getModel("ContractDetailsModel").getData().PartnerBlockQuantity                                                                                                                                
            let PartnerAvailableQuantity = this.getOwnerComponent().getModel("ContractDetailsModel").getData().ApplicationQuantity                                                                                                                             
            let FixationAvailableQuantity = (parseFloat(PartnerAvailableQuantity) - parseFloat(PartnerBlockQuantity))                                                                                                                                          
                                                                                                                                                                                                                                                               
            let isValid = true                                                                                                                                                                                                                                 
            let State = ""                                                                                                                                                                                                                                     
            let Message = ""                                                                                                                                                                                                                                   
                                                                                                                                                                                                                                                               
            if (Fixation.BagPrice < 1 || Fixation.Quantity < 1) {                                                                                                                                                                                              
                isValid = false                                                                                                                                                                                                                                
                State = "Error"                                                                                                                                                                                                                                
                Message = "Quantidade ou preço fornecido é inválido"                                                                                                                                                                                           
            }                                                                                                                                                                                                                                                  
            else if (parseFloat(Fixation.Quantity) > parseFloat(Fixation.AvailableQuantity)) {                                                                                                                                                                 
                isValid = false                                                                                                                                                                                                                                
                State = "Error"                                                                                                                                                                                                                                
                Message = "Quantidade fornecida é superior ao saldo disponível para propriedade"                                                                                                                                                               
                                                                                                                                                                                                                                                               
            } else if (FixationAvailableQuantity < parseFloat(Fixation.Quantity)) {                                                                                                                                                                            
                let PendingQuantity = (FixationAvailableQuantity - parseFloat(Fixation.Quantity)) * -1                                                                                                                                                         
                isValid = false                                                                                                                                                                                                                                
                State = "Error"                                                                                                                                                                                                                                
                Message = "Existem " + PendingQuantity + " KG bloqueados para o parceiro"                                                                                                                                                                      
            }                                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
            return {                                                                                                                                                                                                                                           
                isValid: isValid,                                                                                                                                                                                                                              
                State: State,                                                                                                                                                                                                                                  
                Message: Message                                                                                                                                                                                                                               
            }                                                                                                                                                                                                                                                  
        },                                                                                                                                                                                                                                                     
        onAddLineFixation: function (oEvent) {                                                                                                                                                                                                                 
            var index = 1                                                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
            this.getOwnerComponent().getModel("BankData").oData.items.push(models.createLineFixationBankModel())                                                                                                                                               
            this.getOwnerComponent().getModel("BankData").oData.items.forEach((element) => {                                                                                                                                                                   
                element.Parcel = index                                                                                                                                                                                                                         
                element.PaymentDate = this._PaymentDate                                                                                                                                                                                                        
                index++                                                                                                                                                                                                                                        
            })                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
            this.refreshModel("BankData")                                                                                                                                                                                                                      
        },                                                                                                                                                                                                                                                     
        onDeleteLineFixation: function (oEvent) {                                                                                                                                                                                                              
            var index = 1                                                                                                                                                                                                                                      
            this.byId("BankDataPopupTable")._aSelectedPaths.forEach((element) => {                                                                                                                                                                             
                this.getOwnerComponent().getModel("BankData").oData.items.splice(element.substr(7), 1)                                                                                                                                                         
            })                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
            this.getOwnerComponent().getModel("BankData").oData.items.forEach((element) => {                                                                                                                                                                   
                element.Parcel = index                                                                                                                                                                                                                         
                index++                                                                                                                                                                                                                                        
            })                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
            this.refreshModel("BankData")                                                                                                                                                                                                                      
        },                                                                                                                                                                                                                                                     
        _onSendFixation: function () {                                                                                                                                                                                                                         
            let ContractData = this.getView().getModel("ContractDetailsModel").getData()                                                                                                                                                                       
                                                                                                                                                                                                                                                               
            let Authorization = {                                                                                                                                                                                                                              
                Company_Code: ContractData.CompanyCode,                                                                                                                                                                                                        
                Plant: this._selectedApplication.Plant,                                                                                                                                                                                                        
                Authorization: "FIX_CRT"                                                                                                                                                                                                                       
            }                                                                                                                                                                                                                                                  
            this.authValidate(Authorization).then(() => {                                                                                                                                                                                                      
                MessageBox.show("A fixação será enviada para aprovação, deseja continuar?", {                                                                                                                                                                  
                    title: "Confirmação",                                                                                                                                                                                                                      
                    icon: MessageBox.Icon.INFORMATION,                                                                                                                                                                                                         
                    actions: [MessageBox.Action.YES, MessageBox.Action.NO],                                                                                                                                                                                    
                    emphasizedAction: MessageBox.Action.YES,                                                                                                                                                                                                   
                    onClose: function (oAction) {                                                                                                                                                                                                              
                        if (oAction == "YES") {                                                                                                                                                                                                                
                            this._getFixationData()                                                                                                                                                                                                            
                        }                                                                                                                                                                                                                                      
                    }.bind(this)                                                                                                                                                                                                                               
                })                                                                                                                                                                                                                                             
            }).catch(() => {                                                                                                                                                                                                                                   
                MessageBox.show("Usuário não possui permissão para realizar a fixação", {                                                                                                                                                                      
                    icon: MessageBox.Icon.INFORMATION,                                                                                                                                                                                                         
                    title: "Aviso"                                                                                                                                                                                                                             
                })                                                                                                                                                                                                                                             
            })                                                                                                                                                                                                                                                 
        },                                                                                                                                                                                                                                                     
        FixationDataValidate: function () {                                                                                                                                                                                                                    
            this._FixationData = this.getOwnerComponent().getModel("Fixation").getData()                                                                                                                                                                       
            this._BankData = this.getOwnerComponent().getModel("BankData").getData()                                                                                                                                                                           
            this._ApplicationsProperty = this.getOwnerComponent().getModel("ApplicationsProperty").getData()                                                                                                                                                   
                                                                                                                                                                                                                                                               
            this._Valid = true                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
            try {                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                if (this._selectedApplication == undefined) {                                                                                                                                                                                                  
                    throw "Nenhuma aplicação foi selecionada"                                                                                                                                                                                                  
                }                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                this._Valid = this._FixationData.Amount > 0 ? this._Valid : false                                                                                                                                                                              
                this._Valid = this._FixationData.Quantity > 0 ? this._Valid : false                                                                                                                                                                            
                this._Valid = this._FixationData.PaymentDate != "" ? this._Valid : false                                                                                                                                                                       
                                                                                                                                                                                                                                                               
                let PartnerBlockQuantity = this.getOwnerComponent().getModel("ContractDetailsModel").getData().PartnerBlockQuantity                                                                                                                            
                let PartnerAvailableQuantity = this.getOwnerComponent().getModel("ContractDetailsModel").getData().ApplicationQuantity                                                                                                                         
                let FixationAvailableQuantity = (parseFloat(PartnerAvailableQuantity) - parseFloat(PartnerBlockQuantity))                                                                                                                                      
                                                                                                                                                                                                                                                               
                if (FixationAvailableQuantity < parseFloat(this._FixationData.Quantity)) {                                                                                                                                                                     
                    let PendingQuantity = (FixationAvailableQuantity - parseFloat(this._FixationData.Quantity)) * -1                                                                                                                                           
                    let message = "Existem " + PendingQuantity + " KG bloqueados para o parceiro"                                                                                                                                                              
                    throw message                                                                                                                                                                                                                              
                }                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                if (!this._BankData.items)                                                                                                                                                                                                                     
                    throw "Dados da conta bancária incompletos"                                                                                                                                                                                                
                                                                                                                                                                                                                                                               
                this._BankData.items.forEach((element) => {                                                                                                                                                                                                    
                    Object.keys(element).forEach((obj_element) => {                                                                                                                                                                                            
                        if (element.BankAccountId == "") {                                                                                                                                                                                                     
                            throw "Dados da conta bancária incompletos"                                                                                                                                                                                        
                        }                                                                                                                                                                                                                                      
                    })                                                                                                                                                                                                                                         
                })                                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
                if (!this._ApplicationsProperty.results)                                                                                                                                                                                                       
                    throw "Dados das aplicações consumidas incompletos"                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
                if (this._Valid) {                                                                                                                                                                                                                             
                    this._onSendFixation()                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
                }                                                                                                                                                                                                                                              
                else                                                                                                                                                                                                                                           
                    throw "Dados da fixação incompletos"                                                                                                                                                                                                       
            }                                                                                                                                                                                                                                                  
            catch (error) {                                                                                                                                                                                                                                    
                MessageBox.show(error, {                                                                                                                                                                                                                       
                    icon: MessageBox.Icon.INFORMATION,                                                                                                                                                                                                         
                    title: "Erro"                                                                                                                                                                                                                              
                })                                                                                                                                                                                                                                             
            }                                                                                                                                                                                                                                                  
        },                                                                                                                                                                                                                                                     
        _getFixationData: function () {                                                                                                                                                                                                                        
            this._FixationData = this.getOwnerComponent().getModel("Fixation").getData()                                                                                                                                                                       
            this._BankData = this.getOwnerComponent().getModel("BankData").getData()                                                                                                                                                                           
            this._ApplicationsProperty = this.getOwnerComponent().getModel("ApplicationsProperty").getData()                                                                                                                                                   
            this._ContractData = this.getView().getModel("ContractDetailsModel").getData()                                                                                                                                                                     
                                                                                                                                                                                                                                                               
            var Applications = []                                                                                                                                                                                                                              
            var BankData = []                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
            try {                                                                                                                                                                                                                                              
                this._ApplicationsProperty.results.forEach((element) => {                                                                                                                                                                                      
                    Applications.push({                                                                                                                                                                                                                        
                        ApplicationDoc: element.ApplicationDocNum,                                                                                                                                                                                             
                        EdcNum: element.EdcNum,                                                                                                                                                                                                                
                        EdcType: element.EdcType,                                                                                                                                                                                                              
                        Property: element.Property,                                                                                                                                                                                                            
                        NfeNum: element.NfeNum,                                                                                                                                                                                                                
                        ApplicationQuantity: element.AvailableQuantity - element.FinalQuantity,                                                                                                                                                                
                        IdRoyalties: element.IdRoyalties,                                                                                                                                                                                                      
                        Measure: 'KG'                                                                                                                                                                                                                          
                    })                                                                                                                                                                                                                                         
                })                                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
                this._BankData.items.forEach((element) => {                                                                                                                                                                                                    
                    BankData.push({                                                                                                                                                                                                                            
                        Installment: element.Parcel,                                                                                                                                                                                                           
                        Amount: element.Amount[0],                                                                                                                                                                                                             
                        Currency: 'BRL',                                                                                                                                                                                                                       
                        Quantity: this._getInstallmentQuantity(this._FixationData.Amount, this._FixationData.Quantity, element.Amount[0]),                                                                                                                     
                        Unit: 'KG',                                                                                                                                                                                                                            
                        PaymentDate: this.getOwnerComponent().getModel("Fixation").getData().PaymentDate.replaceAll(".", ""),                                                                                                                                  
                        Bank: element.Bank,                                                                                                                                                                                                                    
                        BankAgency: element.BankAgency,                                                                                                                                                                                                        
                        BankAccount: element.BankAccount,                                                                                                                                                                                                      
                        BankHolder: element.BankHolder,                                                                                                                                                                                                        
                        BankAccountId: element.BankAccountId                                                                                                                                                                                                   
                    })                                                                                                                                                                                                                                         
                })                                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
                this._FixationObject = JSON.stringify([                                                                                                                                                                                                        
                    {                                                                                                                                                                                                                                          
                        Plant: this._selectedApplication.Plant,                                                                                                                                                                                                
                        Contract: this._ContractData.ContractNum,                                                                                                                                                                                              
                        Identification: this._ContractData.IdentificationFix,                                                                                                                                                                                  
                        Quantity: this._FixationData.Quantity,                                                                                                                                                                                                 
                        Unit: 'KG',                                                                                                                                                                                                                            
                        Material: this._ContractData.Material,                                                                                                                                                                                                 
                        MaterialNum: this._ContractData.MaterialNum,                                                                                                                                                                                           
                        BagPrice: this._FixationData.BagPrice[0],                                                                                                                                                                                              
                        Currency: this._FixationData.Currency,                                                                                                                                                                                                 
                        BasisPrice: this._FixationData.BasisPrice,                                                                                                                                                                                             
                        FuturePrice: this._FixationData.FuturePrice,                                                                                                                                                                                           
                        Amount: this._FixationData.Amount,                                                                                                                                                                                                     
                        KeydateCode: this._FixationData.DueCode,                                                                                                                                                                                               
                        DolarQuotation: this._DolarQuotation,                                                                                                                                                                                                  
                        BankData: BankData,                                                                                                                                                                                                                    
                        ApplicationData: Applications,                                                                                                                                                                                                         
                        BlockedQuantity: this._FixationData.BlockedQuantity                                                                                                                                                                                    
                    }                                                                                                                                                                                                                                          
                ])                                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
                this._Send({                                                                                                                                                                                                                                   
                    Action: "FIXCREATE",                                                                                                                                                                                                                       
                    Json: this._FixationObject,                                                                                                                                                                                                                
                    StructureName: "ZADOS_GRAINS_CREATE_FIXATION"                                                                                                                                                                                              
                })                                                                                                                                                                                                                                             
            }                                                                                                                                                                                                                                                  
            catch {                                                                                                                                                                                                                                            
                MessageBox.show("Dados da fixação incompletos", {                                                                                                                                                                                              
                    icon: MessageBox.Icon.INFORMATION,                                                                                                                                                                                                         
                    title: "Aviso"                                                                                                                                                                                                                             
                })                                                                                                                                                                                                                                             
            }                                                                                                                                                                                                                                                  
        },                                                                                                                                                                                                                                                     
        _Send: function (oData) {                                                                                                                                                                                                                              
            sap.ui.core.BusyIndicator.show();                                                                                                                                                                                                                  
            this.clearMessageManager()                                                                                                                                                                                                                         
            this._oModel.create("/JsonCommunicationSet", oData, {                                                                                                                                                                                              
                success: function () {                                                                                                                                                                                                                         
                    let error = this.fillMessagesModel()                                                                                                                                                                                                       
                    this.MessageBarChangeVisible(true)                                                                                                                                                                                                         
                    this._refreshViewData()                                                                                                                                                                                                                    
                    sap.ui.core.BusyIndicator.hide();                                                                                                                                                                                                          
                    if (error) {                                                                                                                                                                                                                               
                        MessageToast.show("Aconteceram erros no processo, visualizar mensagens")                                                                                                                                                               
                    } else {                                                                                                                                                                                                                                   
                        MessageToast.show("Processo executado com sucesso!")                                                                                                                                                                                   
                        setTimeout(function () {                                                                                                                                                                                                               
                            this.getRouter().navTo("RouteContractDetails", {                                                                                                                                                                                   
                                Contract: this.getOwnerComponent().getModel("ContractDetailsModel").getData().ContractNum                                                                                                                                      
                            })                                                                                                                                                                                                                                 
                        }.bind(this), 1000)                                                                                                                                                                                                                    
                    }                                                                                                                                                                                                                                          
                }.bind(this),                                                                                                                                                                                                                                  
                error: function () {                                                                                                                                                                                                                           
                    let error = this.fillMessagesModel()                                                                                                                                                                                                       
                    this.MessageBarChangeVisible(true)                                                                                                                                                                                                         
                    this._refreshViewData()                                                                                                                                                                                                                    
                    sap.ui.core.BusyIndicator.hide();                                                                                                                                                                                                          
                    MessageToast.show("Houve um erro interno")                                                                                                                                                                                                 
                }.bind(this)                                                                                                                                                                                                                                   
            })                                                                                                                                                                                                                                                 
        },                                                                                                                                                                                                                                                     
        _refreshViewData: function () {                                                                                                                                                                                                                        
            this.getOwnerComponent().getModel("ApplicationsProperty").setData({})                                                                                                                                                                              
            this.getOwnerComponent().getModel("BankData").oData.items = []                                                                                                                                                                                     
            this.getOwnerComponent().getModel("Fixation").oData = models.createLineFixation()                                                                                                                                                                  
            this.getOwnerComponent().getModel("Application").setData({})                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
            this.refreshModel("BankData")                                                                                                                                                                                                                      
            this.refreshModel("ApplicationsProperty")                                                                                                                                                                                                          
            this.refreshModel("Fixation")                                                                                                                                                                                                                      
            this.refreshModel("Application")                                                                                                                                                                                                                   
        },                                                                                                                                                                                                                                                     
        _getInstallmentQuantity: function (TotalAmount, Quantity, InstallmentAmount) {                                                                                                                                                                         
            return InstallmentAmount / (TotalAmount / Quantity)                                                                                                                                                                                                
        },                                                                                                                                                                                                                                                     
        onSelectApplication: function (oEvent) {                                                                                                                                                                                                               
            if (this.getOwnerComponent().getModel("Fixation").getData().Quantity > 0) {                                                                                                                                                                        
                var ApplicationEvent = oEvent.oSource._aSelectedPaths[0]                                                                                                                                                                                       
                MessageBox.show("Ao alterar a propriedade os dados da fixação serão perdidos, deseja continuar?", {                                                                                                                                            
                    title: "Confirmação",                                                                                                                                                                                                                      
                    icon: MessageBox.Icon.INFORMATION,                                                                                                                                                                                                         
                    actions: [MessageBox.Action.YES, MessageBox.Action.NO],                                                                                                                                                                                    
                    emphasizedAction: MessageBox.Action.YES,                                                                                                                                                                                                   
                    onClose: function (oAction) {                                                                                                                                                                                                              
                        if (oAction == "YES") {                                                                                                                                                                                                                
                            this._selectedApplication = this.getOwnerComponent().getModel().getData(ApplicationEvent)                                                                                                                                          
                                                                                                                                                                                                                                                               
                            this.getOwnerComponent().getModel("ApplicationsProperty").setData({})                                                                                                                                                              
                            this.getOwnerComponent().getModel("BankData").oData.items = []                                                                                                                                                                     
                            this.getOwnerComponent().getModel("Fixation").oData = models.createLineFixation()                                                                                                                                                  
                                                                                                                                                                                                                                                               
                            this.getOwnerComponent().getModel("Application").setData(this._selectedApplication)                                                                                                                                                
                                                                                                                                                                                                                                                               
                            this._getApplicationData().then(() => {                                                                                                                                                                                            
                                this._getRoyaltiesBlocks()                                                                                                                                                                                                     
                            })                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
                            this.refreshModel("BankData")                                                                                                                                                                                                      
                            this.refreshModel("ApplicationsProperty")                                                                                                                                                                                          
                            this.refreshModel("Fixation")                                                                                                                                                                                                      
                            this.refreshModel("Application")                                                                                                                                                                                                   
                                                                                                                                                                                                                                                               
                            this._selectedApplicationId = this.byId("ApplicationsList").getSelectedItem().sId                                                                                                                                                  
                                                                                                                                                                                                                                                               
                            if (this._selectedApplication.AvailableQuantity < 1) {                                                                                                                                                                             
                                MessageBox.show("Propriedade não possui saldo disponível para fixação", {                                                                                                                                                      
                                    icon: MessageBox.Icon.INFORMATION,                                                                                                                                                                                         
                                    title: "Aviso"                                                                                                                                                                                                             
                                })                                                                                                                                                                                                                             
                                this._selectedApplication = undefined                                                                                                                                                                                          
                                this.byId("ApplicationsList").removeSelections()                                                                                                                                                                               
                            }                                                                                                                                                                                                                                  
                        } else {                                                                                                                                                                                                                               
                            this.byId("ApplicationsList").setSelectedItemById(this._selectedApplicationId, true)                                                                                                                                               
                        }                                                                                                                                                                                                                                      
                    }.bind(this)                                                                                                                                                                                                                               
                })                                                                                                                                                                                                                                             
            } else {                                                                                                                                                                                                                                           
                this._selectedApplication = this.getOwnerComponent().getModel().getData(oEvent.oSource._aSelectedPaths[0])                                                                                                                                     
                this.getOwnerComponent().getModel("Application").setData(this._selectedApplication)                                                                                                                                                            
                this._getApplicationData()                                                                                                                                                                                                                     
                this._selectedApplicationId = this.byId("ApplicationsList").getSelectedItem().sId                                                                                                                                                              
                if (this._selectedApplication.AvailableQuantity < 1) {                                                                                                                                                                                         
                    MessageBox.show("Propriedade não possui saldo disponível para fixação", {                                                                                                                                                                  
                        icon: MessageBox.Icon.INFORMATION,                                                                                                                                                                                                     
                        title: "Aviso"                                                                                                                                                                                                                         
                    })                                                                                                                                                                                                                                         
                    this._selectedApplication = undefined                                                                                                                                                                                                      
                    this.byId("ApplicationsList").removeSelections()                                                                                                                                                                                           
                }                                                                                                                                                                                                                                              
            }                                                                                                                                                                                                                                                  
        },                                                                                                                                                                                                                                                     
        onBankData: function () {                                                                                                                                                                                                                              
            let Partner = this.getOwnerComponent().getModel("ContractDetailsModel").oData.Partner                                                                                                                                                              
            this._oModel.read("/ZADOC_GRAINS_PRICING_BANK_DATA", {                                                                                                                                                                                             
                filters: [                                                                                                                                                                                                                                     
                    new Filter("Partner", FilterOperator.EQ, Partner),                                                                                                                                                                                         
                ],                                                                                                                                                                                                                                             
                success: function (oData) {                                                                                                                                                                                                                    
                    this.getView().setModel(new JSONModel(oData), "BankAccountData")                                                                                                                                                                           
                    this._ShowBankDataPopup()                                                                                                                                                                                                                  
                }.bind(this),                                                                                                                                                                                                                                  
                error: function (oError) {                                                                                                                                                                                                                     
                }                                                                                                                                                                                                                                              
            })                                                                                                                                                                                                                                                 
        },                                                                                                                                                                                                                                                     
        _ShowBankDataPopup: function () {                                                                                                                                                                                                                      
            if (!this._BankDataFragment) {                                                                                                                                                                                                                     
                this._BankDataFragment = Fragment.load({                                                                                                                                                                                                       
                    id: this.getView().getId(),                                                                                                                                                                                                                
                    name: "grains.zadograinsacmcontrolling.view.fragments.BankData",                                                                                                                                                                           
                    controller: this                                                                                                                                                                                                                           
                }).then(function (oValueHelpDialog) {                                                                                                                                                                                                          
                    this.getView().addDependent(oValueHelpDialog);                                                                                                                                                                                             
                    return oValueHelpDialog;                                                                                                                                                                                                                   
                }.bind(this));                                                                                                                                                                                                                                 
            }                                                                                                                                                                                                                                                  
            this._BankDataFragment.then(function (oValueHelpDialog) {                                                                                                                                                                                          
                oValueHelpDialog.open();                                                                                                                                                                                                                       
            });                                                                                                                                                                                                                                                
        },                                                                                                                                                                                                                                                     
        onSaveBankData: function () {                                                                                                                                                                                                                          
            let validation = this._bankDataValidate()                                                                                                                                                                                                          
            if (validation.isValid) {                                                                                                                                                                                                                          
                this.byId("MessageStripBank").setVisible(false)                                                                                                                                                                                                
                this.byId("BankDataDialog").close()                                                                                                                                                                                                            
            } else {                                                                                                                                                                                                                                           
                this.byId("MessageStripBank").setText(validation.Message)                                                                                                                                                                                      
                this.byId("MessageStripBank").setVisible(true)                                                                                                                                                                                                 
            }                                                                                                                                                                                                                                                  
        },                                                                                                                                                                                                                                                     
        onCloseBankData: function () {                                                                                                                                                                                                                         
            this.byId("BankDataDialog").close()                                                                                                                                                                                                                
            this.byId("MessageStripBank").setVisible(false)                                                                                                                                                                                                    
            this.getOwnerComponent().getModel("BankData").oData.items = []                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
            let newLine = models.createLineFixationBankModel()                                                                                                                                                                                                 
            newLine.PaymentDate = this._PaymentDate                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
            this.getOwnerComponent().getModel("BankData").oData.items.push(newLine)                                                                                                                                                                            
            this.getOwnerComponent().getModel("BankData").refresh(true)                                                                                                                                                                                        
        },                                                                                                                                                                                                                                                     
        _bankDataValidate: function () {                                                                                                                                                                                                                       
            let Message = ""                                                                                                                                                                                                                                   
            let isValid = true                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
            let oBankData = this.getView().getModel("BankData").getData().items                                                                                                                                                                                
                                                                                                                                                                                                                                                               
            let Fixation = this.getOwnerComponent().getModel("Fixation").getData()                                                                                                                                                                             
            var BankAmount = 0                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
            oBankData.forEach((element) => {                                                                                                                                                                                                                   
                // Object.keys(element).forEach((obj_element) => {                                                                                                                                                                                             
                //     if (element[obj_element] == "" && obj_element != 'BankHolder') {                                                                                                                                                                        
                //         isValid = false                                                                                                                                                                                                                     
                //         Message = "Dados bancários estão incompletos"                                                                                                                                                                                       
                //     }                                                                                                                                                                                                                                       
                // })                                                                                                                                                                                                                                          
                BankAmount = BankAmount + element.Amount[0]                                                                                                                                                                                                    
            })                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
            if (Fixation.Amount.toFixed(2) - BankAmount.toFixed(2) !== 0) {                                                                                                                                                                                    
                Message = "Valor informado para recebimento é diferente do valor total da fixação"                                                                                                                                                             
                isValid = false                                                                                                                                                                                                                                
            }                                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
            return {                                                                                                                                                                                                                                           
                isValid: isValid,                                                                                                                                                                                                                              
                Message: Message                                                                                                                                                                                                                               
            }                                                                                                                                                                                                                                                  
        },                                                                                                                                                                                                                                                     
        onPressBankData: function (oEvent) {                                                                                                                                                                                                                   
            let sPath = sap.ui.getCore().byId(oEvent.getSource().getParent().sId).oBindingContexts.BankData.sPath                                                                                                                                              
            let LineBankData = this.getOwnerComponent().getModel("BankData").getProperty(sPath)                                                                                                                                                                
                                                                                                                                                                                                                                                               
            let selectedBankData = this.getView().getModel("BankAccountData").getProperty(oEvent.getSource().getSelectedItem().oBindingContexts.BankAccountData.sPath)                                                                                         
                                                                                                                                                                                                                                                               
            LineBankData.BankAccountId = selectedBankData.BankAccountId                                                                                                                                                                                        
            LineBankData.BankId = selectedBankData.BankId                                                                                                                                                                                                      
            LineBankData.BankAgency = selectedBankData.BankAgency                                                                                                                                                                                              
            LineBankData.BankAccount = selectedBankData.BankAccount                                                                                                                                                                                            
            LineBankData.BankCity = selectedBankData.BankCity                                                                                                                                                                                                  
            LineBankData.BankHolder = selectedBankData.BankHolder                                                                                                                                                                                              
            LineBankData.Bank = selectedBankData.Bank                                                                                                                                                                                                          
                                                                                                                                                                                                                                                               
            this.getOwnerComponent().getModel("BankData").setProperty(sPath, LineBankData)                                                                                                                                                                     
            this.refreshModel("BankData")                                                                                                                                                                                                                      
            // this.byId("ListItemBank").setText("sValue")                                                                                                                                                                                                     
        },                                                                                                                                                                                                                                                     
        onKeyDateChange: function () {                                                                                                                                                                                                                         
            if (this.getOwnerComponent().getModel("Fixation").getData().Quantity > 0) {                                                                                                                                                                        
                MessageBox.show("Ao alterar a data os dados da fixação serão perdidos, deseja continuar?", {                                                                                                                                                   
                    title: "Confirmação",                                                                                                                                                                                                                      
                    icon: MessageBox.Icon.INFORMATION,                                                                                                                                                                                                         
                    actions: [MessageBox.Action.YES, MessageBox.Action.NO],                                                                                                                                                                                    
                    emphasizedAction: MessageBox.Action.YES,                                                                                                                                                                                                   
                    onClose: function (oAction) {                                                                                                                                                                                                              
                        if (oAction == "YES") {                                                                                                                                                                                                                
                            this._PaymentDate = this.getOwnerComponent().getModel('Fixation').oData.PaymentDate                                                                                                                                                
                                                                                                                                                                                                                                                               
                            this.getOwnerComponent().getModel("ApplicationsProperty").setData({})                                                                                                                                                              
                            this.getOwnerComponent().getModel("BankData").oData.items = []                                                                                                                                                                     
                            this.getOwnerComponent().getModel("Fixation").oData = models.createLineFixation()                                                                                                                                                  
                            this.getOwnerComponent().getModel('Fixation').oData.PaymentDate = this._PaymentDate                                                                                                                                                
                                                                                                                                                                                                                                                               
                            this.refreshModel("BankData")                                                                                                                                                                                                      
                            this.refreshModel("ApplicationsProperty")                                                                                                                                                                                          
                            this.refreshModel("Fixation")                                                                                                                                                                                                      
                        } else {                                                                                                                                                                                                                               
                            this.getOwnerComponent().getModel('Fixation').oData.PaymentDate = this._PaymentDate                                                                                                                                                
                            this.refreshModel('Fixation')                                                                                                                                                                                                      
                        }                                                                                                                                                                                                                                      
                    }.bind(this)                                                                                                                                                                                                                               
                })                                                                                                                                                                                                                                             
            }                                                                                                                                                                                                                                                  
        },                                                                                                                                                                                                                                                     
        onRebindBlocksTable: function () {                                                                                                                                                                                                                     
            let sPath = this.getStorage("SelectedPath")                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
            this._oContext = new sap.ui.model.Context(this.getOwnerComponent().getModel(), sPath.Path)                                                                                                                                                         
            this.byId("SmartTableBlocks").setBindingContext(this._oContext)                                                                                                                                                                                    
        },                                                                                                                                                                                                                                                     
        onBlockPress: function (oEvent) {                                                                                                                                                                                                                      
            this._ContextBlockPath = new sap.ui.model.Context(this.getOwnerComponent().getModel(), oEvent.getSource().getSelectedContexts()[0].sPath)                                                                                                          
            this.byId("TableBlocks").removeSelections()                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
            if (!this._UnlocksFragment) {                                                                                                                                                                                                                      
                this._UnlocksFragment = Fragment.load({                                                                                                                                                                                                        
                    id: this.getView().getId(),                                                                                                                                                                                                                
                    name: "grains.zadograinsacmcontrolling.view.fragments.PartnerUnlocks",                                                                                                                                                                     
                    controller: this                                                                                                                                                                                                                           
                }).then(function (oValueHelpDialog) {                                                                                                                                                                                                          
                    this.getView().addDependent(oValueHelpDialog);                                                                                                                                                                                             
                    return oValueHelpDialog;                                                                                                                                                                                                                   
                }.bind(this));                                                                                                                                                                                                                                 
            }                                                                                                                                                                                                                                                  
            this._UnlocksFragment.then(function (oValueHelpDialog) {                                                                                                                                                                                           
                this.byId("UnlocksList").rebindList(true)                                                                                                                                                                                                      
                oValueHelpDialog.open();                                                                                                                                                                                                                       
            }.bind(this));                                                                                                                                                                                                                                     
        },                                                                                                                                                                                                                                                     
        onRebindUnlocks: function () {                                                                                                                                                                                                                         
            this.byId("UnlocksList").setBindingContext(this._ContextBlockPath)                                                                                                                                                                                 
        },                                                                                                                                                                                                                                                     
        onLiquidation: function (oEvent) {                                                                                                                                                                                                                     
            let oObject = oEvent.getSource().getBindingContext().getObject()                                                                                                                                                                                   
                                                                                                                                                                                                                                                               
            let Authorization = {                                                                                                                                                                                                                              
                Company_Code: oObject.CompanyCode,                                                                                                                                                                                                             
                Plant: oObject.Plant,                                                                                                                                                                                                                          
                Authorization: "FIX_LIQ"                                                                                                                                                                                                                       
            }                                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
            this.authValidate(Authorization).then(() => {                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
                try {                                                                                                                                                                                                                                          
                    let sPath = this.getView().getObjectBinding().getPath()                                                                                                                                                                                    
                    let oFixationData = this.getView().getModel().getData(sPath)                                                                                                                                                                               
                                                                                                                                                                                                                                                               
                    if (oFixationData.FixationStatus !== 'T')                                                                                                                                                                                                  
                        throw 'Não é possível realizar a liquidação, fixação não aprovada'                                                                                                                                                                     
                                                                                                                                                                                                                                                               
                    sap.ui.core.BusyIndicator.show();                                                                                                                                                                                                          
                    this._sendLiquidation(oFixationData).then((oSuccess) => {                                                                                                                                                                                  
                        let error = this.fillMessagesModel()                                                                                                                                                                                                   
                        this.MessageBarChangeVisible(true)                                                                                                                                                                                                     
                        sap.ui.core.BusyIndicator.hide();                                                                                                                                                                                                      
                        if (error) {                                                                                                                                                                                                                           
                            MessageToast.show("Aconteceram erros no processo, visualizar mensagens")                                                                                                                                                           
                        } else {                                                                                                                                                                                                                               
                            MessageToast.show("Processo executado com sucesso!")                                                                                                                                                                               
                        }                                                                                                                                                                                                                                      
                    }).catch((oError) => {                                                                                                                                                                                                                     
                        let error = this.fillMessagesModel()                                                                                                                                                                                                   
                        this.MessageBarChangeVisible(true)                                                                                                                                                                                                     
                        sap.ui.core.BusyIndicator.hide();                                                                                                                                                                                                      
                        MessageToast.show("Houve um erro interno")                                                                                                                                                                                             
                    })                                                                                                                                                                                                                                         
                }                                                                                                                                                                                                                                              
                catch (error) {                                                                                                                                                                                                                                
                    MessageToast.show("Falha ao efetuar a liquidação")                                                                                                                                                                                         
                }                                                                                                                                                                                                                                              
            }).catch(() => {                                                                                                                                                                                                                                   
                MessageBox.show("Usuário não possui permissão para realizar a liquidação", {                                                                                                                                                                   
                    icon: MessageBox.Icon.INFORMATION,                                                                                                                                                                                                         
                    title: "Aviso"                                                                                                                                                                                                                             
                })                                                                                                                                                                                                                                             
            })                                                                                                                                                                                                                                                 
        },                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
        _sendLiquidation: function (FixationData) {                                                                                                                                                                                                            
            return new Promise((resolve, reject) => {                                                                                                                                                                                                          
                try {                                                                                                                                                                                                                                          
                    var oData = {                                                                                                                                                                                                                              
                        Action: "LIQUIDATE",                                                                                                                                                                                                                   
                        Json: JSON.stringify([{                                                                                                                                                                                                                
                            Contract: FixationData.ContractNum,                                                                                                                                                                                                
                            Identification: FixationData.FixationId                                                                                                                                                                                            
                        }]),                                                                                                                                                                                                                                   
                        StructureName: "ZADOS_GRAINS_CREATE_FIXATION"                                                                                                                                                                                          
                    }                                                                                                                                                                                                                                          
                }                                                                                                                                                                                                                                              
                catch {                                                                                                                                                                                                                                        
                    reject()                                                                                                                                                                                                                                   
                }                                                                                                                                                                                                                                              
                this.clearMessageManager()                                                                                                                                                                                                                     
                this._oModel.create("/JsonCommunicationSet", oData, {                                                                                                                                                                                          
                    success: function (oData) {                                                                                                                                                                                                                
                        resolve()                                                                                                                                                                                                                              
                    }.bind(this),                                                                                                                                                                                                                              
                    error: function (oError) {                                                                                                                                                                                                                 
                        reject()                                                                                                                                                                                                                               
                    }.bind(this)                                                                                                                                                                                                                               
                })                                                                                                                                                                                                                                             
            })                                                                                                                                                                                                                                                 
        },                                                                                                                                                                                                                                                     
        onPrintForm: function (oEvent) {                                                                                                                                                                                                                       
            let oData = this.getView().getModel().getData(this.getStorage("Fixation").sPath)                                                                                                                                                                   
            this._PreviewSmartform(this.getView(), 'ZADOSF_GRAINS_BOL_FIX', {                                                                                                                                                                                  
                contract_num: oData.ContractNum,                                                                                                                                                                                                               
                plant_nr: oData.Plant,                                                                                                                                                                                                                         
                idnum: oData.FixationId                                                                                                                                                                                                                        
            })                                                                                                                                                                                                                                                 
        },                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
        onInvoicePost: function (oEvent) {                                                                                                                                                                                                                     
            let oObject = oEvent.getSource().getBindingContext().getObject()                                                                                                                                                                                   
                                                                                                                                                                                                                                                               
            let Authorization = {                                                                                                                                                                                                                              
                Company_Code: oObject.CompanyCode,                                                                                                                                                                                                             
                Plant: oObject.Plant,                                                                                                                                                                                                                          
                Authorization: "FIX_LIQ"                                                                                                                                                                                                                       
            }                                                                                                                                                                                                                                                  
            this.authValidate(Authorization).then(() => {                                                                                                                                                                                                      
                sap.ui.core.BusyIndicator.show();                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
                this.getModel().create("/JsonCommunicationSet", {                                                                                                                                                                                              
                    Action: "INVOICEPST",                                                                                                                                                                                                                      
                    Json: JSON.stringify([{                                                                                                                                                                                                                    
                        settlement_group_id: oObject.SettlementGroupId,                                                                                                                                                                                        
                        settlement_doc_year: oObject.SettlementDocYear,                                                                                                                                                                                        
                    }]),                                                                                                                                                                                                                                       
                    StructureName: "ZADOS_GRAINS_SETTLEMENT_GROUP"                                                                                                                                                                                             
                }, {                                                                                                                                                                                                                                           
                    success: function (oData) {                                                                                                                                                                                                                
                        let error = this.fillMessagesModel()                                                                                                                                                                                                   
                        this.MessageBarChangeVisible(true)                                                                                                                                                                                                     
                        MessageToast.show("Processo executado com sucesso!")                                                                                                                                                                                   
                        sap.ui.core.BusyIndicator.hide();                                                                                                                                                                                                      
                    }.bind(this),                                                                                                                                                                                                                              
                    error: function () {                                                                                                                                                                                                                       
                        let error = this.fillMessagesModel()                                                                                                                                                                                                   
                        this.MessageBarChangeVisible(true)                                                                                                                                                                                                     
                        MessageToast.show("Aconteceram erros no processo, visualizar mensagens")                                                                                                                                                               
                        sap.ui.core.BusyIndicator.hide();                                                                                                                                                                                                      
                    }.bind(this)                                                                                                                                                                                                                               
                })                                                                                                                                                                                                                                             
                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
            }).catch(() => {                                                                                                                                                                                                                                   
                MessageBox.show("Usuário não possui permissão para realizar o registro da fatura", {                                                                                                                                                           
                    icon: MessageBox.Icon.INFORMATION,                                                                                                                                                                                                         
                    title: "Aviso"                                                                                                                                                                                                                             
                })                                                                                                                                                                                                                                             
            })                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
        },                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
        onInvoicePostManually: function (oEvent) {                                                                                                                                                                                                             
            debugger                                                                                                                                                                                                                                           
            let oObject = oEvent.getSource().getBindingContext().getObject()                                                                                                                                                                                   
                                                                                                                                                                                                                                                               
            let Authorization = {                                                                                                                                                                                                                              
                Company_Code: oObject.CompanyCode,                                                                                                                                                                                                             
                Plant: oObject.Plant,                                                                                                                                                                                                                          
                Authorization: "FIX_LIQ"                                                                                                                                                                                                                       
            }                                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
            this.authValidate(Authorization).then(() => {                                                                                                                                                                                                      
                                                                                                                                                                                                                                                               
                this.callTransaction("SupplierInvoice", "displayAdvanced", {                                                                                                                                                                                   
                    SupplierInvoice: oObject.InvoiceDoc,                                                                                                                                                                                                       
                    FiscalYear: oObject.InvoiceDocYear,                                                                                                                                                                                                        
                });                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
            }).catch(() => {                                                                                                                                                                                                                                   
                MessageBox.show("Usuário não possui permissão para realizar o registro da fatura", {                                                                                                                                                           
                    icon: MessageBox.Icon.INFORMATION,                                                                                                                                                                                                         
                    title: "Aviso"                                                                                                                                                                                                                             
                })                                                                                                                                                                                                                                             
            })                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
        },                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
        onGoToClearing: function (oEvent) {                                                                                                                                                                                                                    
            var oObject = oEvent.getSource().getBindingContext().getObject();                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
            var additionalUrl = "&/Invoice/" + oObject.ContractNum + "-" + oObject.AbdNumber                                                                                                                                                                   
                                                                                                                                                                                                                                                               
            this.callTransactionWithAdditionalURL(                                                                                                                                                                                                             
                "ZOILACMTRANSEMUL",                                                                                                                                                                                                                            
                "zacmmntcontragricinvoicescomp",                                                                                                                                                                                                               
                additionalUrl                                                                                                                                                                                                                                  
            );                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
        },                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
        onGoToApprove: function (oEvent) {                                                                                                                                                                                                                     
            var oObject = oEvent.getSource().getBindingContext().getObject();                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
            var additionalUrl = "&/Fixação/" + oObject.ContractNum + "-" + oObject.IdentificationFix                                                                                                                                                           
                                                                                                                                                                                                                                                               
            this.callTransactionWithAdditionalURL(                                                                                                                                                                                                             
                "ZOILACMTRANSEMUL",                                                                                                                                                                                                                            
                "zacmmntcontragricaprov",                                                                                                                                                                                                                      
                additionalUrl                                                                                                                                                                                                                                  
            );                                                                                                                                                                                                                                                 
                                                                                                                                                                                                                                                               
        },                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
    });                                                                                                                                                                                                                                                        
});                                                                                                                                                                                                                                                            