sap.ui.define([                                                                                                                                                                                                                                                
    "sap/ui/core/mvc/Controller",                                                                                                                                                                                                                              
    "sap/ui/core/routing/History"                                                                                                                                                                                                                              
], function (Controller, History) {                                                                                                                                                                                                                            
    "use strict";                                                                                                                                                                                                                                              
                                                                                                                                                                                                                                                               
    return Controller.extend("grains.zadograinsacmcontrollingapproval.controller.BaseController", {                                                                                                                                                            
        /**                                                                                                                                                                                                                                                    
         * Convenience method for accessing the router in every controller of the application.                                                                                                                                                                 
         * @public                                                                                                                                                                                                                                             
         * @returns {sap.ui.core.routing.Router} the router for this component                                                                                                                                                                                 
         */                                                                                                                                                                                                                                                    
        getRouter: function () {                                                                                                                                                                                                                               
            return this.getOwnerComponent().getRouter();                                                                                                                                                                                                       
        },                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
        /**                                                                                                                                                                                                                                                    
         * Convenience method for getting the view model by name in every controller of the application.                                                                                                                                                       
         * @public                                                                                                                                                                                                                                             
         * @param {string} sName the model name                                                                                                                                                                                                                
         * @returns {sap.ui.model.Model} the model instance                                                                                                                                                                                                    
         */                                                                                                                                                                                                                                                    
        getModel: function (sName) {                                                                                                                                                                                                                           
            return this.getView().getModel(sName);                                                                                                                                                                                                             
        },                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
        /**                                                                                                                                                                                                                                                    
         * Convenience method for setting the view model in every controller of the application.                                                                                                                                                               
         * @public                                                                                                                                                                                                                                             
         * @param {sap.ui.model.Model} oModel the model instance                                                                                                                                                                                               
         * @param {string} sName the model name                                                                                                                                                                                                                
         * @returns {sap.ui.mvc.View} the view instance                                                                                                                                                                                                        
         */                                                                                                                                                                                                                                                    
        setModel: function (oModel, sName) {                                                                                                                                                                                                                   
            return this.getView().setModel(oModel, sName);                                                                                                                                                                                                     
        },                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
        /**                                                                                                                                                                                                                                                    
         * Convenience method for getting the resource bundle.                                                                                                                                                                                                 
         * @public                                                                                                                                                                                                                                             
         * @returns {sap.ui.model.resource.ResourceModel} the resourceModel of the component                                                                                                                                                                   
         */                                                                                                                                                                                                                                                    
        getResourceBundle: function () {                                                                                                                                                                                                                       
            return this.getOwnerComponent().getModel("i18n").getResourceBundle();                                                                                                                                                                              
        },                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
        /**                                                                                                                                                                                                                                                    
         * Method for navigation to specific view                                                                                                                                                                                                              
         * @public                                                                                                                                                                                                                                             
         * @param {string} psTarget Parameter containing the string for the target navigation                                                                                                                                                                  
         * @param {Object.<string, string>} pmParameters? Parameters for navigation                                                                                                                                                                            
         * @param {boolean} pbReplace? Defines if the hash should be replaced (no browser history entry) or set (browser history entry)                                                                                                                        
         */                                                                                                                                                                                                                                                    
        navTo: function (psTarget, pmParameters, pbReplace) {                                                                                                                                                                                                  
            this.getRouter().navTo(psTarget, pmParameters, pbReplace);                                                                                                                                                                                         
        },                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
        /**                                                                                                                                                                                                                                                    
         * Event handler for navigating back.                                                                                                                                                                                                                  
         * It there is a history entry we go one step back in the browser history                                                                                                                                                                              
         * If not, it will replace the current entry of the browser history with the list route.                                                                                                                                                               
         * @public                                                                                                                                                                                                                                             
         */                                                                                                                                                                                                                                                    
        onNavBack: function () {                                                                                                                                                                                                                               
            var sPreviousHash = History.getInstance().getPreviousHash();                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
            if (sPreviousHash !== undefined) {                                                                                                                                                                                                                 
                // eslint-disable-next-line sap-no-history-manipulation                                                                                                                                                                                        
                history.go(-1);                                                                                                                                                                                                                                
            } else {                                                                                                                                                                                                                                           
                this.getRouter().navTo("list", {}, true);                                                                                                                                                                                                      
            }                                                                                                                                                                                                                                                  
        },                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
        onRemoveSelections: function (oEvent) {                                                                                                                                                                                                                
            var oSmartTable = oEvent.getSource().getParent().getParent();                                                                                                                                                                                      
            var oTable = oSmartTable.getTable();                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
            oTable.removeSelections();                                                                                                                                                                                                                         
        },                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
        onRefreshSmartTable: function (oEvent) {                                                                                                                                                                                                               
            var oSmartTable = oEvent.getSource().getParent().getParent();                                                                                                                                                                                      
            oSmartTable.rebindTable()                                                                                                                                                                                                                          
        },                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
        JsonCommunication: function (payload) {                                                                                                                                                                                                                
                                                                                                                                                                                                                                                               
            return new Promise(function (resolve, reject) {                                                                                                                                                                                                    
                var oViewModel = this.getModel("detailView");                                                                                                                                                                                                  
                var oModel = this.getView().getModel();                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
                oModel.create("/JsonCommunicationSet", payload, {                                                                                                                                                                                              
                    success: function (oData, oResponse) {                                                                                                                                                                                                     
                        setTimeout(                                                                                                                                                                                                                            
                            function () {                                                                                                                                                                                                                      
                                var oButton = this.byId("MessageIndicator");                                                                                                                                                                                   
                                this.onMessagesButtonPress(oButton);                                                                                                                                                                                           
                            }.bind(this),                                                                                                                                                                                                                      
                            100                                                                                                                                                                                                                                
                        );                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
                        oViewModel.setProperty("/busy", false);                                                                                                                                                                                                
                        resolve()                                                                                                                                                                                                                              
                    }.bind(this),                                                                                                                                                                                                                              
                    error: function (oError) {                                                                                                                                                                                                                 
                        setTimeout(                                                                                                                                                                                                                            
                            function () {                                                                                                                                                                                                                      
                                var oButton = this.byId("MessageIndicator");                                                                                                                                                                                   
                                this.onMessagesButtonPress(oButton);                                                                                                                                                                                           
                            }.bind(this),                                                                                                                                                                                                                      
                            100                                                                                                                                                                                                                                
                        );                                                                                                                                                                                                                                     
                        oViewModel.setProperty("/busy", false);                                                                                                                                                                                                
                        reject();                                                                                                                                                                                                                              
                    }.bind(this),                                                                                                                                                                                                                              
                });                                                                                                                                                                                                                                            
                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
            }.bind(this));                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
        },                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
        onMessagesButtonPress: function (oEvent) {                                                                                                                                                                                                             
            var that = this;                                                                                                                                                                                                                                   
            try {                                                                                                                                                                                                                                              
                var oMessagesButton = oEvent.getSource();                                                                                                                                                                                                      
            } catch (error) {                                                                                                                                                                                                                                  
                var oMessagesButton = oEvent;                                                                                                                                                                                                                  
            }                                                                                                                                                                                                                                                  
                                                                                                                                                                                                                                                               
            if (!this._messagePopover) {                                                                                                                                                                                                                       
                this._messagePopover = new sap.m.MessagePopover({                                                                                                                                                                                              
                    headerButton: new sap.m.Button({                                                                                                                                                                                                           
                        type: sap.m.ButtonType.Reject,                                                                                                                                                                                                         
                        icon: "sap-icon://delete",                                                                                                                                                                                                             
                        press: function () {                                                                                                                                                                                                                   
                            this._messagePopover.close();                                                                                                                                                                                                      
                            sap.ui.getCore().getMessageManager().removeAllMessages()                                                                                                                                                                           
                        }.bind(this),                                                                                                                                                                                                                          
                    }),                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
                    items: {                                                                                                                                                                                                                                   
                        path: "message>/",                                                                                                                                                                                                                     
                        template: new sap.m.MessageItem({                                                                                                                                                                                                      
                            description: "{message>description}",                                                                                                                                                                                              
                            type: "{message>type}",                                                                                                                                                                                                            
                            title: "{message>message}",                                                                                                                                                                                                        
                            subtitle: "{message>additionalText}",                                                                                                                                                                                              
                            description: "{message>description}",                                                                                                                                                                                              
                        }),                                                                                                                                                                                                                                    
                    },                                                                                                                                                                                                                                         
                });                                                                                                                                                                                                                                            
                oMessagesButton.addDependent(this._messagePopover);                                                                                                                                                                                            
            }                                                                                                                                                                                                                                                  
            this._messagePopover.toggle(oMessagesButton);                                                                                                                                                                                                      
        },                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
        onCreateDialog: function (sTitle, oContent, oBeginButton, oEndButton, contentWidth) {                                                                                                                                                                  
            // if (!this.oDefaultDialog) {                                                                                                                                                                                                                     
            this.oDefaultDialog = new sap.m.Dialog({                                                                                                                                                                                                           
                title: sTitle,                                                                                                                                                                                                                                 
                content: oContent,                                                                                                                                                                                                                             
                beginButton: oBeginButton,                                                                                                                                                                                                                     
                endButton: oEndButton,                                                                                                                                                                                                                         
                horizontalScrolling: true,                                                                                                                                                                                                                     
                resizable: true,                                                                                                                                                                                                                               
                contentWidth: contentWidth                                                                                                                                                                                                                     
            });                                                                                                                                                                                                                                                
                                                                                                                                                                                                                                                               
            this.getView().addDependent(this.oDefaultDialog);                                                                                                                                                                                                  
            // }                                                                                                                                                                                                                                               
            // this.oDefaultDialog.addStyleClass("sapUiContentPadding");                                                                                                                                                                                       
            this.oDefaultDialog.open();                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
            this.oDefaultDialog.attachAfterClose(                                                                                                                                                                                                              
                function () {                                                                                                                                                                                                                                  
                    this.oDefaultDialog.destroy();                                                                                                                                                                                                             
                }.bind(this)                                                                                                                                                                                                                                   
            );                                                                                                                                                                                                                                                 
        },                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
        submitError: function (responseBody) {                                                                                                                                                                                                                 
            try {                                                                                                                                                                                                                                              
                var body = JSON.parse(responseBody);                                                                                                                                                                                                           
                var errorDetails = body.error.innererror.errordetails;                                                                                                                                                                                         
                if (errorDetails) {                                                                                                                                                                                                                            
                    if (errorDetails.length > 0) {                                                                                                                                                                                                             
                        for (let i = 0; i < errorDetails.length; i++) {                                                                                                                                                                                        
                            sap.m.MessageBox.error(errorDetails[i].message);                                                                                                                                                                                   
                                                                                                                                                                                                                                                               
                        }                                                                                                                                                                                                                                      
                    } else sap.m.MessageBox.error(body.error.message.value);                                                                                                                                                                                   
                } else sap.m.MessageBox.error(body.error.message.value);                                                                                                                                                                                       
            } catch (err) {                                                                                                                                                                                                                                    
                try {                                                                                                                                                                                                                                          
                    //the error is in xml format. Technical error by framework                                                                                                                                                                                 
                    switch (typeof responseBody) {                                                                                                                                                                                                             
                        case "string": // XML or simple text                                                                                                                                                                                                   
                            if (responseBody.indexOf("<?xml") > -1) {                                                                                                                                                                                          
                                var oXML = jQuery.parseXML(responseBody);                                                                                                                                                                                      
                                var oXMLMsg = oXML.querySelector("message");                                                                                                                                                                                   
                                if (oXMLMsg) sap.m.MessageBox.error(oXMLMsg.textContent);                                                                                                                                                                      
                            } else sap.m.MessageBox.error(responseBody);                                                                                                                                                                                       
                                                                                                                                                                                                                                                               
                            break;                                                                                                                                                                                                                             
                        case "object": // Exception                                                                                                                                                                                                            
                            sap.m.MessageBox.error(responseBody.toString());                                                                                                                                                                                   
                            break;                                                                                                                                                                                                                             
                    }                                                                                                                                                                                                                                          
                } catch (err) {                                                                                                                                                                                                                                
                    sap.m.MessageBox.error("common error message");                                                                                                                                                                                            
                }                                                                                                                                                                                                                                              
            }                                                                                                                                                                                                                                                  
        },                                                                                                                                                                                                                                                     
                                                                                                                                                                                                                                                               
                                                                                                                                                                                                                                                               
    });                                                                                                                                                                                                                                                        
                                                                                                                                                                                                                                                               
});                                                                                                                                                                                                                                                            