sap.ui.define(["./BaseController","sap/ui/core/Fragment","sap/ui/model/json/JSONModel","sap/ui/model/Filter","sap/ui/model/FilterOperator","sap/m/MessageBox","sap/m/MessageToast","../model/formatter","../model/models"],function(t,e,o,i,n,a,s,r,c){"use st+
rict";return t.extend("grains.zadograinsacmcontrolling.controller.ContractDetails",{formatter:r,onInit:function(){this.initMessageProcessor();this.getRouter().attachRoutePatternMatched(this._onObjectMathed,this);this.getView().addEventDelegate({onAfterSh+
ow:function(){}.bind(this)})},_onObjectMathed:function(t){this._Contract=t.getParameter("arguments").Contract;this._getMonitorBehavior()},_getMonitorBehavior:function(){let t=this.getStorage("SelectedPath");this.getModel().read(t.Path,{success:function(t+
){this.getOwnerComponent().setModel(new o(t),"ContractDetailsModel");this.getModel().read("/ZADOC_GRAINS_MON_BEHAVIOR",{filters:[new i("CompanyCode",n.EQ,t.CompanyCode),new i("AppCode",n.EQ,"ACMCONTROL"),new i("ContractType",n.EQ,t.TradingContractType)],+
success:function(t){this.getOwnerComponent().getModel("ViewConfigurations").setData(t.results[0]!=undefined?t.results[0]:c.createLineConfigurationsModel());this.refreshModel("ViewConfigurations");this._getViewData()}.bind(this),error:function(){}})}.bind+
(this),error:function(){}})},onFixationPress:function(t){this._SelectedFixation=this.getView().getModel().getData(t.oSource._aSelectedPaths[0]);this.putStorage("Fixation",{sPath:t.oSource._aSelectedPaths[0]});this.byId("TableFixations").removeSelections(+
);if(this.getView().getModel().getData(this.getView().getObjectBinding().sPath).Type=="ZC"){this.getRouter().navTo("RouteContractFixation",{Contract:this._Contract,Fixation:this._SelectedFixation.FixationId})}else{this.getRouter().navTo("RouteSalesContra+
ctFixation",{Contract:this._Contract,Fixation:this._SelectedFixation.FixationId})}},onCreateFixation:function(t){let e=t.getSource().getBindingContext().getObject();let o={Company_Code:e.CompanyCode,Plant:e.Plant,Authorization:"FIX_CRT"};this.authValidat+
e(o).then(()=>{if(e.ContractStatus=="L"||e.ContractStatus=="T"){if(this.getView().getModel().getData(this.getView().getObjectBinding().sPath).Type=="ZC"){this.getRouter().navTo("RouteContractFixation",{Contract:this._Contract,Fixation:""})}else{this.getR+
outer().navTo("RouteSalesContractFixation",{Contract:this._Contract,Fixation:""})}}else{a.show("O contrato não encontra-se em um status válido para realizar a fixação",{icon:a.Icon.INFORMATION,title:"Aviso"})}}).catch(()=>{a.show("Usuário não possui perm+
issão para realizar a fixação",{icon:a.Icon.INFORMATION,title:"Aviso"})})},onContractFlow:function(t){if(!this._FlowFragment){this._FlowFragment=e.load({id:this.getView().getId(),name:"grains.zadograinsacmcontrolling.view.fragments.ContractFlow",controll+
er:this}).then(function(t){this.getView().addDependent(t);return t}.bind(this))}this._FlowFragment.then(function(t){t.open()})},onGrainsBalances:function(t){let e=t.getSource().getBindingContext().getObject();let o=e.ContractNum;let i=e.Partner;let n="ZT+
ACM0025";let a=`https://${window.location.hostname}:${window.location.port}`;let s=`/sap/bc/gui/sap/its/webgui?&saml2=disabled&~transaction=${n}`;let r=`&%20S_TKONN-LOW=${o}&%20S_ELIFN-LOW=${i}&~OKCODE=ENTE`;let c=a+s+r;sap.m.URLHelper.redirect(c)},onCon+
tractBalances:function(){if(!this._BalanceFragment){this._BalanceFragment=e.load({id:this.getView().getId(),name:"grains.zadograinsacmcontrolling.view.fragments.Balance",controller:this}).then(function(t){this.getView().addDependent(t);return t}.bind(thi+
s))}this._BalanceFragment.then(function(t){this.byId("BalanceSmartList").setBindingContext(this._oContext);t.open()}.bind(this))},_getViewData:function(){let t=this.getStorage("SelectedPath");this.getView().bindElement(t.Path);this._oContext=new sap.ui.m+
odel.Context(this.getOwnerComponent().getModel(),t.Path);this.byId("SmartTableFixations").setBindingContext(this._oContext)},onContractEdit:function(t){},onRebindBlocksTable:function(){let t=this.getStorage("SelectedPath");this._oContext=new sap.ui.model+
.Context(this.getOwnerComponent().getModel(),t.Path);this.byId("SmartTableBlocks").setBindingContext(this._oContext)},onBlockPress:function(t){this._ContextBlockPath=new sap.ui.model.Context(this.getOwnerComponent().getModel(),t.getSource().getSelectedCo+
ntexts()[0].sPath);this.byId("TableBlocks").removeSelections();if(!this._UnlocksFragment){this._UnlocksFragment=e.load({id:this.getView().getId(),name:"grains.zadograinsacmcontrolling.view.fragments.PartnerUnlocks",controller:this}).then(function(t){this+
.getView().addDependent(t);return t}.bind(this))}this._UnlocksFragment.then(function(t){this.byId("UnlocksList").rebindList(true);t.open()}.bind(this))},onRebindUnlocks:function(){this.byId("UnlocksList").setBindingContext(this._ContextBlockPath)},onGoTo+
Approve:function(t){var e=t.getSource().getBindingContext().getObject();var o="&/Fixação/"+e.ContractNum+"-"+e.FixationId;this.callTransactionWithAdditionalURL("ZOILACMTRANSEMUL","zacmmntcontragricaprov",o)},onGoToClearing:function(t){var e=t.getSource()+
.getBindingContext().getObject();var o="&/Invoice/"+e.ContractNum+"-"+e.AbdNumber;this.callTransactionWithAdditionalURL("ZOILACMTRANSEMUL","zacmmntcontragricinvoicescomp",o)},onLiquidate:function(t){let e=t.getSource().getBindingContext().getObject();let+
 o={Company_Code:e.CompanyCode,Plant:e.Plant,Authorization:"FIX_LIQ"};this.authValidate(o).then(()=>{sap.ui.core.BusyIndicator.show();this._sendLiquidation(e).then(t=>{let e=this.fillMessagesModel();this.MessageBarChangeVisible(true);sap.ui.core.BusyIndi+
cator.hide();if(e){s.show("Aconteceram erros no processo, visualizar mensagens")}else{s.show("Processo executado com sucesso!")}}).catch(t=>{console.log(t);let e=this.fillMessagesModel();this.MessageBarChangeVisible(true);sap.ui.core.BusyIndicator.hide()+
;s.show("Houve um erro interno")})}).catch(t=>{console.log(t);a.show("Usuário não possui permissão para realizar a liquidação",{icon:a.Icon.INFORMATION,title:"Aviso"})})},_sendLiquidation:function(t){return new Promise((e,o)=>{var i=this.getView().getMod+
el();var n={Action:"LIQUIDATE",Json:JSON.stringify([{Contract:t.ContractNum,Identification:t.FixationId}]),StructureName:"ZADOS_GRAINS_CREATE_FIXATION"};this.clearMessageManager();i.create("/JsonCommunicationSet",n,{success:function(t){debugger;var o=thi+
s.byId("SmartTableFixations");o.rebindTable();e(t)}.bind(this),error:function(t){o(t)}.bind(this)})})},onInvoicePost:function(t){var e=this.getView().getModel();let o=t.getSource().getBindingContext().getObject();let i={Company_Code:o.CompanyCode,Plant:o+
.Plant,Authorization:"FIX_LIQ"};this.authValidate(i).then(()=>{sap.ui.core.BusyIndicator.show();e.create("/JsonCommunicationSet",{Action:"INVOICEPST",Json:JSON.stringify([{settlement_group_id:o.SettlementGroupId,settlement_doc_year:o.SettlementDocYear}])+
,StructureName:"ZADOS_GRAINS_SETTLEMENT_GROUP"},{success:function(t){let e=this.fillMessagesModel();this.MessageBarChangeVisible(true);s.show("Processo executado com sucesso!");this.byId("SmartTableFixations").rebindTable(true);sap.ui.core.BusyIndicator.+
hide()}.bind(this),error:function(){let t=this.fillMessagesModel();this.MessageBarChangeVisible(true);s.show("Aconteceram erros no processo, visualizar mensagens");sap.ui.core.BusyIndicator.hide()}.bind(this)})}).catch(()=>{a.show("Usuário não possui per+
missão para realizar o registro da fatura",{icon:a.Icon.INFORMATION,title:"Aviso"})})},onInvoicePostManually:function(t){debugger;let e=t.getSource().getBindingContext().getObject();let o={Company_Code:e.CompanyCode,Plant:e.Plant,Authorization:"FIX_LIQ"}+
;this.authValidate(o).then(()=>{this.callTransaction("SupplierInvoice","displayAdvanced",{SupplierInvoice:e.InvoiceDoc,FiscalYear:e.InvoiceDocYear})}).catch(()=>{a.show("Usuário não possui permissão para realizar o registro da fatura",{icon:a.Icon.INFORM+
ATION,title:"Aviso"})})}})});                                                                                                                                                                                                                                  