sap.ui.define(["./BaseController","sap/ui/model/json/JSONModel","../model/formatter","sap/m/library"],function(e,t,i,s){"use strict";var a=s.URLHelper;return e.extend("grains.zadograinsacmcontrollingapproval.controller.DetailFixation",{formatter:i,onInit+
:function(){var e=new t({busy:false,delay:0,lineItemListTitle:this.getResourceBundle().getText("detailLineItemTableHeading")});this.getRouter().getRoute("objectFixation").attachPatternMatched(this._onObjectMatched,this);this.setModel(e,"detailView");this+
.getOwnerComponent().getModel().metadataLoaded().then(this._onMetadataLoaded.bind(this));var i=new sap.ui.core.message.ControlMessageProcessor;this._oMessageManager=sap.ui.getCore().getMessageManager();this._oMessageManager.registerMessageProcessor(i)},o+
nListUpdateFinished:function(e){var t,i=e.getParameter("total"),s=this.getModel("detailView");if(this.byId("lineItemsList").getBinding("items").isLengthFinal()){if(i){t=this.getResourceBundle().getText("detailLineItemTableHeadingCount",[i])}else{t=this.g+
etResourceBundle().getText("detailLineItemTableHeading")}s.setProperty("/lineItemListTitle",t)}},onApprovePress:function(e){this._setStatus(e,"T")},onRejectPress:function(e){var t=this.getResourceBundle().getText("rejectReason");var i=new sap.m.Button({t+
ype:sap.m.ButtonType.Emphasized,text:this.getResourceBundle().getText("confirm"),press:function(e){var t=this.byId("textArea");this.rejectText=t.getValue();if(this.rejectText==""){t.setValueState("Error");t.setPlaceholder("Preencha o motivo da rejeição")+
;return}this._setStatus(e,"S");this.oDefaultDialog.close()}.bind(this)});var s=new sap.m.Button({text:this.getResourceBundle().getText("cancel"),press:function(e){this.oDefaultDialog.close()}.bind(this)});var a=new sap.m.VBox({items:[new sap.m.TextArea(t+
his.getView().createId("textArea"),{width:"100%",height:"100%",rows:4,valueLiveUpdate:true,liveChange:function(e){this.rejectText=e.getParameter("value");if(this.rejectText!=""){e.getSource().setValueState("None");e.getSource().setPlaceholder("")}else{e.+
getSource().setValueState("Error");e.getSource().setPlaceholder("Preencha o motivo da rejeição")}}.bind(this)})]});this.onCreateDialog(t,a,i,s,"700px")},onNotificationPress:function(e){var t=this.getView().getModel();var i=e.getSource().getBindingContext+
().getObject();if(i.NewStatus!="S"){return}var s=this.getResourceBundle().getText("rejectReason");var a;var n=new sap.m.Button({text:"Ok",press:function(e){this.oDefaultDialog.close()}.bind(this)});t.read("/ZADOC_GRAINS_TXT('"+i.Guid+"')",{success:functi+
on(e,t){var i=new sap.m.VBox({items:[new sap.m.Text(this.getView().createId("textRejectReason"),{text:e.Text})]});i.addStyleClass("sapUiSmallMargin");this.onCreateDialog(s,i,a,n,"700px")}.bind(this),error:function(e){setTimeout(function(){var e=this.byId+
("MessageIndicator");this.onMessagesButtonPress(e)}.bind(this),100);oViewModel.setProperty("/busy",false)}.bind(this)})},onReversePress:function(e){this._setStatus(e,"U")},onBeforeRebindSmartlist:function(e){var t=e.getParameter("bindingParams");if(!t.so+
rter.length){t.sorter.push(new sap.ui.model.Sorter("CreatedOn",true))}},_setStatus:function(e,t){var i=e.getSource().getBindingContext().getObject();var s=this.byId("SmartListHistory");var a=[{plant:i.FixationPlant,contractnum:i.TradingContractNumber,ide+
ntification_fix:i.IdentificationFix,new_status:t,text:this.rejectText}];var n={Action:"FIXSETSTAT",StructureName:"ZADOS_GRAINS_SET_FIX_STATUS",Json:JSON.stringify(a)};var o=this.getModel("detailView");o.setProperty("/busy",true);this.JsonCommunication(n)+
.then(function(e,t){s.rebindList();this.getView().getModel().refresh();o.setProperty("/busy",false)}.bind(this))},_onObjectMatched:function(e){var t={ObjectId:e.getParameter("arguments").objectId,ObjectFixation:e.getParameter("arguments").objectFixation,+
Type:e.getSource().getPattern().split("/")[0]};this.getModel("appView").setProperty("/layout","TwoColumnsMidExpanded");this.getModel().metadataLoaded().then(function(){var e=this.getModel().createKey("ZADOC_GRAINS_APPROVAL_LIST",{TradingContractNumber:t.+
ObjectId,Type:t.Type,IdentificationFix:t.ObjectFixation});this._bindView("/"+e)}.bind(this))},_bindView:function(e){var t=this.getModel("detailView");t.setProperty("/busy",false);this.getView().bindElement({path:e,events:{change:this._onBindingChange.bin+
d(this),dataRequested:function(){t.setProperty("/busy",true)},dataReceived:function(){t.setProperty("/busy",false)}.bind(this)}})},_onBindingChange:function(){var e=this.getView(),t=e.getElementBinding();if(!t.getBoundContext()){this.getRouter().getTarge+
ts().display("detailObjectNotFound");this.getOwnerComponent().oListSelector.clearMasterListSelection();this.onCloseDetailPress();return}var i=this.byId("SmartTableFixingItems");i.rebindTable();var s=t.getPath(),a=this.getResourceBundle(),n=e.getModel().g+
etObject(s),o=n.TradingContractNumber,r=n.TradingContractNumber,l=this.getModel("detailView");this.getOwnerComponent().oListSelector.selectAListItem(s);sap.ui.getCore().getMessageManager().removeAllMessages()},_onMetadataLoaded:function(){var e=this.getV+
iew().getBusyIndicatorDelay(),t=this.getModel("detailView"),i=this.byId("lineItemsList");t.setProperty("/delay",0);t.setProperty("/lineItemTableDelay",0);t.setProperty("/busy",true);t.setProperty("/delay",e)},onBeforeRebindSmartTable:function(e){var t=th+
is.getView().getBindingContext().getObject().IdentificationFix;var i=e.getParameter("bindingParams");var s=new sap.ui.model.Filter("IdentificationFix",sap.ui.model.FilterOperator.EQ,t);i.filters.push(s)},onCloseDetailPress:function(){this.getModel("appVi+
ew").setProperty("/actionButtonsInfo/midColumn/fullScreen",false);var e=this.getOwnerComponent().oListSelector;e.clearMasterListSelection();this.getRouter().navTo("list")},toggleFullScreen:function(){var e=this.getModel("appView").getProperty("/actionBut+
tonsInfo/midColumn/fullScreen");this.getModel("appView").setProperty("/actionButtonsInfo/midColumn/fullScreen",!e);if(!e){this.getModel("appView").setProperty("/previousLayout",this.getModel("appView").getProperty("/layout"));this.getModel("appView").set+
Property("/layout","MidColumnFullScreen")}else{this.getModel("appView").setProperty("/layout",this.getModel("appView").getProperty("/previousLayout"))}}})});                                                                                                  