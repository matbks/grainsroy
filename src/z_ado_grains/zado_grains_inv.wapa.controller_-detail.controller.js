sap.ui.define(["./BaseController","sap/ui/model/json/JSONModel","../model/formatter","sap/m/library","sap/ui/Device","sap/m/MessagePopover","sap/m/MessageItem","sap/m/MessageToast"],function(e,t,n,i,a,o,r,s){"use strict";var d=i.URLHelper;return e.extend+
("grains.zadograinsacmcontrollingclearingacc.controller.Detail",{formatter:n,onInit:function(){var e=new t({busy:false,delay:0,lineItemListTitle:this.getResourceBundle().getText("detailLineItemTableHeading"),routeParameters:{}});this.getRouter().getRoute+
("object").attachPatternMatched(this._onObjectMatched,this);this.getRouter().getRoute("detail").attachPatternMatched(this._onObjectMatchedDetail,this);this.setModel(e,"detailView");this.getOwnerComponent().getModel().metadataLoaded().then(this._onMetadat+
aLoaded.bind(this))},onListUpdateFinished:function(e){var t,n=e.getParameter("total"),i=this.getModel("detailView");if(this.byId("lineItemsList").getBinding("items").isLengthFinal()){if(n){t=this.getResourceBundle().getText("detailLineItemTableHeadingCou+
nt",[n])}else{t=this.getResourceBundle().getText("detailLineItemTableHeading")}i.setProperty("/lineItemListTitle",t)}},_onObjectMatched:function(e){var t=this.getView().getModel();var n=this.getView().getModel("detailView");var i=this.getOwnerComponent()+
.getModel("actualSettlementInvoice");var a=i.getData();var o=e.getParameter("arguments");n.setProperty("/routeParameters",o);a.TradingContract=o.TradingContract;a.AbdNumber=o.AbdNumber;i.refresh();this.getModel("appView").setProperty("/layout","TwoColumn+
sMidExpanded");t.metadataLoaded().then(function(){var e=t.createKey("/ZADOC_GRAINS_CTR_APP_INV_SD",{TradingContract:o.TradingContract,AbdNumber:o.AbdNumber});this._bindView(e)}.bind(this))},_onObjectMatchedDetail:function(e){var t=this.getView().getModel+
();var n=this.getView().getModel("detailView");var i=this.getOwnerComponent().getModel("actualSettlementInvoice");var a=i.getData();var o=e.getParameter("arguments");n.setProperty("/routeParameters",o);a.TradingContract=o.TradingContract;a.AbdNumber=o.Ab+
dNumber;i.refresh();this.getModel("appView").setProperty("/layout","ThreeColumnsMidExpanded");t.metadataLoaded().then(function(){var e=t.createKey("/ZADOC_GRAINS_CTR_APP_INV_SD",{TradingContract:o.TradingContract,AbdNumber:o.AbdNumber});this._bindView(e)+
}.bind(this))},_bindView:function(e){var t=this.getModel("detailView");t.setProperty("/busy",false);this.getView().bindElement({path:e,events:{change:this._onBindingChange.bind(this),dataRequested:function(e){t.setProperty("/busy",true)},dataReceived:fun+
ction(e){t.setProperty("/busy",false)}.bind(this)}})},_onBindingChange:function(e){var t=this.getView(),n=t.getElementBinding();if(!n.getBoundContext()){this.getRouter().getTargets().display("detailObjectNotFound");this.getOwnerComponent().oListSelector.+
clearMasterListSelection();return}var i=n.getPath();var a=this.getResourceBundle();var o=this.getView().getModel("detailView");var r=o.getProperty("/routeParameters");var s=this.getView().getModel();var d=s.createKey("/ZADOC_GRAINS_CTR_APP_INV_SD",{Tradi+
ngContract:r.TradingContract,AbdNumber:r.AbdNumber});this.getOwnerComponent().oListSelector.selectAListItem(d);if(r.AbdItem){var c=s.createKey("/ZADOC_GRAINS_CTR_APP_INV_IV",{TradingContract:r.TradingContract,AbdNumber:r.AbdNumber,AbdItem:r.AbdItem});thi+
s.byId("smartTableInvoiceItems").getTable().setSelectedContextPaths([c])}else{this.byId("smartTableInvoiceItems").getTable().removeSelections()}},_onMetadataLoaded:function(){var e=this.getView().getBusyIndicatorDelay(),t=this.getModel("detailView"),n=th+
is.byId("smartTableInvoiceItems"),i=n.getBusyIndicatorDelay();t.setProperty("/delay",0);t.setProperty("/invoiceItemsBusyDelay",0);n.attachEventOnce("updateFinished",function(){t.setProperty("/invoiceItemsBusyDelay",i)});t.setProperty("/busy",true);t.setP+
roperty("/delay",e)},onCloseDetailPress:function(){this.getModel("appView").setProperty("/actionButtonsInfo/midColumn/fullScreen",false);this.getOwnerComponent().oListSelector.clearMasterListSelection();this.getRouter().navTo("list")},toggleFullScreen:fu+
nction(){var e=this.getModel("appView").getProperty("/actionButtonsInfo/midColumn/fullScreen");this.getModel("appView").setProperty("/actionButtonsInfo/midColumn/fullScreen",!e);if(!e){this.getModel("appView").setProperty("/previousLayout",this.getModel(+
"appView").getProperty("/layout"));this.getModel("appView").setProperty("/layout","MidColumnFullScreen")}else{this.getModel("appView").setProperty("/layout",this.getModel("appView").getProperty("/previousLayout"))}},onBeforeRebindInvoiceItems:function(e)+
{},onRefreshSmartTable:function(e){var t=e.getSource().getParent().getParent();t.rebindTable()},onSelectionChangeInvoiceItems:function(e){var t=e.getSource().getSelectedItem().getBindingContext().getObject();var n=!a.system.phone;this.getModel("appView")+
.setProperty("/layout","ThreeColumnsMidExpanded");var i=this.getView().getModel("detailView");var o=i.getProperty("/routeParameters");this.getRouter().navTo("detail",{TradingContract:t.TradingContract,AbdNumber:t.AbdNumber,AbdItem:t.AbdItem},n)},onFullIn+
voiceItems:function(e){},onExecuteClearing:function(e){var t=this.getOwnerComponent().getModel("actualSettlementInvoice");var n=t.getData();var i=this.getModel("detailView");var a=this.getView().getBindingContext().getObject();var o=[{contract_num:a.Trad+
ingContract,invoice:a.InvoiceDoc,test_run:"",mode:"N"}];var r={Action:"ACC_CLEAR",StructureName:"ZADOS_GRAINS_ACC_CLEAR",Json:JSON.stringify(o)};i.setProperty("/busy",true);this.JsonCommunication(r).then(function(e,a){n.isInicialized=false;t.refresh();th+
is.getView().getModel().refresh();this.onTreeTableRefresh();i.setProperty("/busy",false)}.bind(this))},onCancelClearing:function(e){var t=this.getOwnerComponent().getModel("actualSettlementInvoice");var n=t.getData();var i=this.getModel("detailView");var+
 a=this.getView().getBindingContext().getObject();var o=[{company_code:a.InvoiceCompanyCode,clearing_doc:a.ClearingDocument,clearing_year:a.ClearingDocumentYear,mode:"N"}];var r={Action:"CLEAR_REV",StructureName:"ZADOS_GRAINS_ACC_CLEAR_REVERSE",Json:JSON+
.stringify(o)};i.setProperty("/busy",true);this.JsonCommunication(r).then(function(e,a){n.isInicialized=false;t.refresh();this.onTreeTableRefresh();this.getView().getModel().refresh();i.setProperty("/busy",false)}.bind(this))},onAccountingDocumentPress:f+
unction(e){var t=e.getSource().getBindingContext().getObject();this.callTransaction("AccountingDocument","manage",{AccountingDocument:t.AccountingDocument,FiscalYear:t.AccountingDocumentYear,CompanyCode:t.InvoiceCompanyCode})},onClearingDocumentPress:fun+
ction(e){var t=e.getSource().getBindingContext().getObject();this.callTransaction("AccountingDocument","manage",{AccountingDocument:t.ClearingDocument,FiscalYear:t.ClearingDocumentYear,CompanyCode:t.InvoiceCompanyCode})}})});                              