sap.ui.define(["./BaseController","sap/ui/model/json/JSONModel","../model/formatter","sap/m/library","sap/m/MessageToast","sap/ui/core/Fragment"],function(e,t,a,i,o,r){"use strict";var n=i.URLHelper;return e.extend("royalties.zroyalties.controller.Detail+
",{formatter:a,onInit:function(){var e=new t({busy:false,delay:0,lineItemListTitle:this.getResourceBundle().getText("detailLineItemTableHeading")});this.getRouter().getRoute("object").attachPatternMatched(this._onObjectMatched,this);this.setModel(e,"deta+
ilView");this.getOwnerComponent().getModel().metadataLoaded().then(this._onMetadataLoaded.bind(this));this.setSmartTable("st_log")},onSendEmailPress:function(){var e=this.getModel("detailView");n.triggerEmail(null,e.getProperty("/shareSendEmailSubject"),+
e.getProperty("/shareSendEmailMessage"))},handleSaveBtnPress:function(e){var t=this.getView().byId("st_log");var a=this.getOwnerComponent().getModel("Monitor");var i=this.getView().getModel();var r=this.byId("dischargeInput").mProperties.value;var n=this+
.getView().byId("Protocol").getValue();if(r){var s=/[a-zA-Z]/g;if(s.test(r)){o.show("Este campo não pode conter letras")}else{var l=this.byId("balanceInput").mProperties.value;if(parseFloat(r)>parseFloat(l)){o.show("Insira uma baixa de valor inferior ou +
igual ao saldo")}else{if(r.includes(",")){r=r.toString().replace(",",".")}if(r<0||isNaN(r))o.show("Insira um valor válido");else{var g=new Date;var d=g.getFullYear();var h={Plant:a.oData.Plant,Romaneio:a.oData.Romaneio,Edcnumber:a.oData.EdcNum,Discharge:+
r.toString(),Fiscalyear:d.toString(),Balance:(l-parseFloat(r)).toString(),Dischargestatus:"BAIXA MANUAL",Createdon:new Date,Operation:"1",Protocol:n};i.create("/DischargeQtySet",h,{success:function(e,a){if(a.statusCode=="201"){var i=this.getOwnerComponen+
t().getModel("i18n").getResourceBundle().getText("discharged");this.getSmartTable("st_monitor").rebindTable();t.rebindTable();o.show(i);this.handleCancelBtnPress()}}.bind(this),error:function(e){var t=JSON.parse(e.responseText);var a=t.error.message.valu+
e;o.show(a)}})}}}}else{o.show("Preencha os campos obrigatórios")}},handleCancelBtnPress:function(){this.byId("dischargeInput").mProperties.value="";this.byId("balanceInput").mProperties.value="";this.byId("openDialog").destroy()},onListUpdateFinished:fun+
ction(e){var t,a=e.getParameter("total"),i=this.getModel("detailView");if(this.byId("lineItemsList").getBinding("items").isLengthFinal()){if(a){t=this.getResourceBundle().getText("detailLineItemTableHeadingCount",[a])}else{t=this.getResourceBundle().getT+
ext("detailLineItemTableHeading")}i.setProperty("/lineItemListTitle",t)}},_onObjectMatched:function(e){var t=e.getParameter("arguments").objectId;this.getModel("appView").setProperty("/layout","TwoColumnsBeginExpanded");this.getModel().metadataLoaded().t+
hen(function(){var e=this.getModel().createKey("ZADOC_ROYALTIES_MONITOR",{EdcNum:t});this._bindView("/"+e)}.bind(this))},_bindView:function(e){var t=this.getModel("detailView");t.setProperty("/busy",false);this.getView().bindElement({path:e,events:{chang+
e:this._onBindingChange.bind(this),dataRequested:function(){t.setProperty("/busy",true)},dataReceived:function(){t.setProperty("/busy",false)}}})},expandMonitor:function(){this.getModel("appView").setProperty("/layout","OneColumn")},_onBindingChange:func+
tion(){var e=this.getView(),t=e.getElementBinding();if(!t.getBoundContext()){this.getRouter().getTargets().display("detailObjectNotFound");this.getOwnerComponent().oListSelector.clearListListSelection();return}var a=t.getPath(),i=this.getResourceBundle()+
,o=e.getModel().getObject(a),r=o.EdcNum,n=o.EdcNum,s=this.getModel("detailView");this.getOwnerComponent().oListSelector.selectAListItem(a);s.setProperty("/shareSendEmailSubject",i.getText("shareSendEmailObjectSubject",[r]));s.setProperty("/shareSendEmail+
Message",i.getText("shareSendEmailObjectMessage",[n,r,location.href]))},_onMetadataLoaded:function(){var e=this.getView().getBusyIndicatorDelay(),t=this.getModel("detailView"),a=this.byId("lineItemsList"),i=a.getBusyIndicatorDelay();t.setProperty("/delay+
",0);t.setProperty("/lineItemTableDelay",0);a.attachEventOnce("updateFinished",function(){t.setProperty("/lineItemTableDelay",i)});t.setProperty("/busy",true);t.setProperty("/delay",e)},onCloseDetailPress:function(){this.getModel("appView").setProperty("+
/actionButtonsInfo/midColumn/fullScreen",false);var e=this.getSmartTable("st_monitor").getTable();e.removeSelections();this.getRouter().navTo("list")},onDischarge:function(e){var t=this.getSmartTable("st_monitor");let a=t.getTable();var i=a._aSelectedPat+
hs;if(i.length<1){o.show(this.getOwnerComponent().getModel("i18n").getResourceBundle().getText("nullRegisterNotAllowed"))}else{var n=a.getModel().getProperty(i.toString());var s=this.getView();var l=s.getModel("Monitor");l.refresh();l.setData(n);var g=th+
is.getOwnerComponent().getModel("Monitor");var d=parseFloat(g.getData().ApplicationQuantity);g.setProperty("/Balance",this.getBalance(d));if(!this.byId("openDialog")){r.load({id:s.getId(),name:"royalties.zroyalties.view.fragments.Discharge",controller:th+
is}).then(function(e){s.addDependent(e);e.open()})}else{this.byId("openDialog").open()}}},getBalance:function(e){var t=0;let a=this.getView().byId("st_log");var i=a.getTable().getItems().length;for(var o=0;o<i;o++){var r=a.getTable().getItems()[o].getBin+
dingContext().getObject();if(!r.Discharge.includes(",")&&!r.Discharge==""){r.Discharge=r.Discharge;t=t+parseFloat(r.Discharge)}}var n=e-t;return(n>=0?n:"0").toFixed(2).toString()},toggleFullScreen:function(){var e=this.getModel("appView").getProperty("/a+
ctionButtonsInfo/midColumn/fullScreen");this.getModel("appView").setProperty("/actionButtonsInfo/midColumn/fullScreen",!e);if(!e){this.getModel("appView").setProperty("/previousLayout",this.getModel("appView").getProperty("/layout"));this.getModel("appVi+
ew").setProperty("/layout","MidColumnFullScreen")}else{this.getModel("appView").setProperty("/layout",this.getModel("appView").getProperty("/previousLayout"))}},onDischargeDelete:function(){let e=this.getSmartTable("st_monitor");let t=e.getTable();var a=+
t._aSelectedPaths;if(a.length<1){o.show(this.getOwnerComponent().getModel("i18n").getResourceBundle().getText("nullRegisterNotAllowed"))}else{var i=t.getModel().getProperty(a.toString());var r=this.getView();var n=r.getModel();var s=this.getOwnerComponen+
t().getModel("Monitor");let c=this.getView().byId("st_log");let u=c.getTable();var l=u._aSelectedPaths;if(l.length<1){o.show(this.getOwnerComponent().getModel("i18n").getResourceBundle().getText("nullRegisterNotAllowed"))}else{var g=c.getModel().getPrope+
rty(l.toString());var d=r.getModel("Discharge");d.setData(g);var n=this.getView().getModel();var h={Plant:s.getData().Plant,Romaneio:s.getData().Romaneio,Edcnumber:d.getData().EdcNumber,Discharge:d.getData().Discharge,Fiscalyear:d.getData().FiscalYear,Cr+
eatedon:new Date(d.getData().CreatedOn),Dischargestatus:"BAIXA MANUAL",Operation:"2"};n.create("/DischargeQtySet",h,{success:function(t,a){if(a.statusCode=="201"){var i=this.getOwnerComponent().getModel("i18n").getResourceBundle().getText("dischargeDelet+
ed");e.rebindTable();o.show(i);d.setData(null);c.rebindTable();s.refresh(true)}}.bind(this),error:function(e){var t=JSON.parse(e.responseText);var a=t.error.message.value;o.show(a)}})}}}})});                                                                